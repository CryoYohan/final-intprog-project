{"ast":null,"code":"import { HttpResponse, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { of, throwError } from 'rxjs';\nimport { delay, materialize, dematerialize } from 'rxjs/operators';\nimport { Role } from '@app/_models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services\";\n// array in local storage for accounts\nconst accountsKey = 'request-management-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n// array in local storage for employees\nconst employeesKey = 'request-management-employees';\nlet employees = JSON.parse(localStorage.getItem(employeesKey)) || [];\n// array in local storage for departments\nconst departmentsKey = 'request-management-departments';\nlet departments = JSON.parse(localStorage.getItem(departmentsKey)) || [{\n  id: 1,\n  name: 'HR',\n  description: 'Human Resources'\n}, {\n  id: 2,\n  name: 'IT',\n  description: 'Information Technology'\n}, {\n  id: 3,\n  name: 'Finance',\n  description: 'Finance Department'\n}, {\n  id: 4,\n  name: 'Marketing',\n  description: 'Marketing Department'\n}];\n// array in local storage for requests and their items\nconst requestsKey = 'request-management-requests';\nlet requests = JSON.parse(localStorage.getItem(requestsKey)) || [];\n// array in local storage for request items\nconst requestItemsKey = 'request-management-items';\nlet requestItems = JSON.parse(localStorage.getItem(requestItemsKey)) || [];\n// array in local storage for workflows\nconst workflowsKey = 'request-management-workflows';\nlet workflows = JSON.parse(localStorage.getItem(workflowsKey)) || [];\n// array in local storage for employee positions\nconst positionsKey = 'request-management-positions';\nlet positions = JSON.parse(localStorage.getItem(positionsKey)) || [{\n  id: 1,\n  name: 'Manager',\n  description: 'Department Manager'\n}, {\n  id: 2,\n  name: 'Team Lead',\n  description: 'Team Leader'\n}, {\n  id: 3,\n  name: 'Senior Staff',\n  description: 'Senior Level Staff'\n}, {\n  id: 4,\n  name: 'Junior Staff',\n  description: 'Junior Level Staff'\n}];\n// array in local storage for request types\nconst requestTypesKey = 'request-management-request-types';\nlet requestTypes = JSON.parse(localStorage.getItem(requestTypesKey)) || [{\n  id: 1,\n  name: 'Leave Request',\n  description: 'Request for leave or time off'\n}, {\n  id: 2,\n  name: 'Equipment Request',\n  description: 'Request for office equipment'\n}, {\n  id: 3,\n  name: 'Training Request',\n  description: 'Request for training or workshops'\n}, {\n  id: 4,\n  name: 'Other',\n  description: 'Other types of requests'\n}];\n// Helper functions for generating IDs\nfunction newAccountId() {\n  return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n}\nfunction newRequestId() {\n  return requests.length ? Math.max(...requests.map(x => x.id)) + 1 : 1;\n}\nfunction newRequestItemId() {\n  return requestItems.length ? Math.max(...requestItems.map(x => x.id)) + 1 : 1;\n}\nfunction newEmployeeId() {\n  return employees.length ? Math.max(...employees.map(x => x.id)) + 1 : 1;\n}\nfunction newWorkflowId() {\n  return workflows.length ? Math.max(...workflows.map(x => x.id)) + 1 : 1;\n}\nfunction newDepartmentId() {\n  return departments.length ? Math.max(...departments.map(x => x.id)) + 1 : 1;\n}\nfunction newPositionId() {\n  return positions.length ? Math.max(...positions.map(x => x.id)) + 1 : 1;\n}\nfunction newRequestTypeId() {\n  return requestTypes.length ? Math.max(...requestTypes.map(x => x.id)) + 1 : 1;\n}\n// Helper functions for JWT and refresh tokens\nfunction generateJwtToken(account) {\n  try {\n    const header = btoa(JSON.stringify({\n      alg: 'HS256',\n      typ: 'JWT'\n    }));\n    const now = new Date().getTime();\n    const payload = {\n      id: account.id,\n      role: account.role,\n      email: account.email,\n      iat: now,\n      exp: now + 24 * 60 * 60 * 1000 // 24 hours expiry\n    };\n\n    const payloadBase64 = btoa(JSON.stringify(payload));\n    const signature = btoa('fake-jwt-secret-key');\n    return `${header}.${payloadBase64}.${signature}`;\n  } catch (error) {\n    console.error('Error generating JWT token:', error);\n    throw error;\n  }\n}\nfunction generateRefreshToken() {\n  try {\n    const header = btoa(JSON.stringify({\n      alg: 'HS256',\n      typ: 'JWT'\n    }));\n    const now = new Date().getTime();\n    const payload = {\n      id: Math.random().toString(36).substr(2),\n      iat: now,\n      exp: now + 7 * 24 * 60 * 60 * 1000 // 7 days expiry\n    };\n\n    const payloadBase64 = btoa(JSON.stringify(payload));\n    const signature = btoa('fake-refresh-secret-key');\n    return `${header}.${payloadBase64}.${signature}`;\n  } catch (error) {\n    console.error('Error generating refresh token:', error);\n    throw error;\n  }\n}\nfunction isTokenExpired(token) {\n  if (!token) return true;\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 3) return true;\n    const payload = JSON.parse(atob(parts[1]));\n    if (!payload || typeof payload.exp !== 'number') return true;\n    return payload.exp < new Date().getTime();\n  } catch (error) {\n    console.error('Error checking token expiration:', error);\n    return true;\n  }\n}\nexport let FakeBackendInterceptor = /*#__PURE__*/(() => {\n  class FakeBackendInterceptor {\n    constructor(alertService) {\n      this.alertService = alertService;\n    }\n    intercept(request, next) {\n      const {\n        url,\n        method,\n        headers,\n        body\n      } = request;\n      const alertService = this.alertService;\n      // Helper functions\n      function ok(body) {\n        return of(new HttpResponse({\n          status: 200,\n          body\n        }));\n      }\n      function error(message) {\n        return throwError(() => ({\n          error: {\n            message\n          }\n        }));\n      }\n      function unauthorized() {\n        return throwError(() => ({\n          status: 401,\n          error: {\n            message: 'Unauthorized'\n          }\n        }));\n      }\n      function notFound() {\n        return throwError(() => ({\n          status: 404,\n          error: {\n            message: 'Not Found'\n          }\n        }));\n      }\n      function basicDetails(account) {\n        const {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          status,\n          isVerified\n        } = account;\n        return {\n          id,\n          title,\n          firstName,\n          lastName,\n          email,\n          role,\n          status,\n          isVerified\n        };\n      }\n      function isAuthenticated() {\n        try {\n          const authHeader = headers.get('Authorization');\n          if (!(authHeader === null || authHeader === void 0 ? void 0 : authHeader.startsWith('Bearer '))) return false;\n          const token = authHeader.split(' ')[1];\n          if (isTokenExpired(token)) {\n            console.log('JWT token has expired');\n            return false;\n          }\n          const parts = token.split('.');\n          const payload = JSON.parse(atob(parts[1]));\n          const account = accounts.find(x => x.id === payload.id);\n          return !!account;\n        } catch (error) {\n          console.error('Authentication check error:', error);\n          return false;\n        }\n      }\n      function isAdmin() {\n        var _a;\n        return ((_a = currentAccount()) === null || _a === void 0 ? void 0 : _a.role) === Role.Admin;\n      }\n      function currentAccount() {\n        if (!isAuthenticated()) return null;\n        try {\n          const authHeader = headers.get('Authorization');\n          if (!(authHeader === null || authHeader === void 0 ? void 0 : authHeader.startsWith('Bearer '))) return null;\n          const token = authHeader.split(' ')[1];\n          const parts = token.split('.');\n          const payload = JSON.parse(atob(parts[1]));\n          // Find account by ID from token payload\n          const account = accounts.find(x => x.id === payload.id);\n          if (!account) {\n            console.log('No account found for token payload ID:', payload.id);\n            return null;\n          }\n          return account;\n        } catch (error) {\n          console.error('Error getting current account:', error);\n          return null;\n        }\n      }\n      function idFromUrl() {\n        const urlParts = url.split('/');\n        // Handle URLs that end with /status\n        if (urlParts[urlParts.length - 1] === 'status') {\n          return parseInt(urlParts[urlParts.length - 2]);\n        }\n        return parseInt(urlParts[urlParts.length - 1]);\n      }\n      function getWorkflowsByEmployeeId() {\n        if (!isAuthenticated()) return unauthorized();\n        const internalId = parseInt(url.split('/').pop());\n        console.log('Looking for workflows with employeeId:', internalId);\n        // Only include objects that are true workflows (type is 'Added', 'Updated', or 'Transferred' and do NOT have request-like properties)\n        const workflowTypes = ['Added', 'Updated', 'Transferred'];\n        const employeeWorkflows = workflows.filter(wf => {\n          return wf.employeeId === internalId && typeof wf.type === 'string' && workflowTypes.includes(wf.type) && !('items' in wf) && !('typeId' in wf) && !('description' in wf);\n        });\n        console.log('Found workflows:', employeeWorkflows.length);\n        // Sort workflows in descending order by creation date\n        const sortedWorkflows = [...employeeWorkflows].sort((a, b) => {\n          const dateA = new Date(a.datetimecreated || a.createdDate);\n          const dateB = new Date(b.datetimecreated || b.createdDate);\n          return dateB.getTime() - dateA.getTime();\n        });\n        return ok(sortedWorkflows.map(workflow => {\n          // Ensure details is a string\n          let details = '';\n          if (typeof workflow.details === 'object') {\n            details = workflow.details.task || '';\n            if (workflow.details.additionalInfo) {\n              details += ` - ${workflow.details.additionalInfo}`;\n            }\n          } else {\n            details = workflow.details || '';\n          }\n          // Always provide datetimecreated\n          const datetimecreated = workflow.datetimecreated || workflow.createdDate;\n          return {\n            id: workflow.id.toString(),\n            type: workflow.type,\n            details: details,\n            status: workflow.status,\n            datetimecreated: datetimecreated,\n            employeeId: workflow.employeeId\n          };\n        }));\n      }\n      return handleRoute().pipe(delay(500), materialize(), dematerialize());\n      function handleRoute() {\n        switch (true) {\n          case url.endsWith('/accounts/authenticate') && method === 'POST':\n            return authenticate();\n          case url.endsWith('/accounts/refresh-token') && method === 'POST':\n            return refreshToken();\n          case url.endsWith('/accounts/revoke-token') && method === 'POST':\n            return revokeToken();\n          case url.endsWith('/accounts/register') && method === 'POST':\n            return register();\n          case url.endsWith('/accounts/verify-email') && method === 'POST':\n            return verifyEmail();\n          case url.endsWith('/accounts') && method === 'GET':\n            return getAccounts();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n            return getAccountById();\n          case url.endsWith('/accounts') && method === 'POST':\n            return createAccount();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n            return updateAccount();\n          case url.match(/\\/accounts\\/\\d+$/) && method === 'DELETE':\n            return deleteAccount();\n          // request routes\n          case url.endsWith('/requests') && method === 'GET':\n            return getRequests();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'GET':\n            return getRequestById();\n          case url.match(/\\/requests\\/employee\\/\\d+$/) && method === 'GET':\n            return getRequestsByEmployeeId();\n          case url.endsWith('/requests/my-requests') && method === 'GET':\n            return getMyRequests();\n          case url.endsWith('/requests') && method === 'POST':\n            return createRequest();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n            return updateRequest();\n          case url.match(/\\/requests\\/\\d+\\/status$/) && method === 'PUT':\n            return changeRequestStatus();\n          case url.match(/\\/requests\\/\\d+$/) && method === 'DELETE':\n            return deleteRequest();\n          // employee routes\n          case url.endsWith('/employees') && method === 'GET':\n            return getEmployees();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'GET':\n            return getEmployeeById();\n          case url.endsWith('/employees') && method === 'POST':\n            return createEmployee();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n            return updateEmployee();\n          case url.match(/\\/employees\\/\\d+$/) && method === 'DELETE':\n            return deleteEmployee();\n          case url.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'PUT':\n            return transferEmployee();\n          // department routes\n          case url.endsWith('/departments') && method === 'GET':\n            return getDepartments();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'GET':\n            return getDepartmentById();\n          case url.endsWith('/departments') && method === 'POST':\n            return createDepartment();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n            return updateDepartment();\n          case url.match(/\\/departments\\/\\d+$/) && method === 'DELETE':\n            return deleteDepartment();\n          // position routes\n          case url.endsWith('/positions') && method === 'GET':\n            return getPositions();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'GET':\n            return getPositionById();\n          case url.endsWith('/positions') && method === 'POST':\n            return createPosition();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'PUT':\n            return updatePosition();\n          case url.match(/\\/positions\\/\\d+$/) && method === 'DELETE':\n            return deletePosition();\n          // request type routes\n          case url.endsWith('/request-types') && method === 'GET':\n            return getRequestTypes();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'GET':\n            return getRequestTypeById();\n          case url.endsWith('/request-types') && method === 'POST':\n            return createRequestType();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'PUT':\n            return updateRequestType();\n          case url.match(/\\/request-types\\/\\d+$/) && method === 'DELETE':\n            return deleteRequestType();\n          // workflow routes\n          case url.endsWith('/workflows') && method === 'GET':\n            return getWorkflows();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'GET':\n            return getWorkflowById();\n          case url.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n            return getWorkflowsByEmployeeId();\n          case url.match(/\\/workflows\\/request\\/\\d+$/) && method === 'GET':\n            return getWorkflowsByRequestId();\n          case url.endsWith('/workflows') && method === 'POST':\n            return createWorkflow();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n            return updateWorkflow();\n          case url.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n            return updateWorkflowStatus();\n          case url.match(/\\/workflows\\/\\d+$/) && method === 'DELETE':\n            return deleteWorkflow();\n          case url.match(/\\/workflows\\/items\\/\\d+$/) && method === 'DELETE':\n            return deleteWorkflowItem();\n          default:\n            return next.handle(request);\n        }\n      }\n      // Authentication functions\n      function authenticate() {\n        const {\n          email,\n          password\n        } = body;\n        const account = accounts.find(x => x.email === email);\n        if (!account) return error('Email or password is incorrect');\n        if (password !== account.password) return error('Email or password is incorrect');\n        if (!account.isVerified) return error('Please verify your email before logging in');\n        try {\n          // Initialize refreshTokens array if it doesn't exist\n          if (!account.refreshTokens) {\n            account.refreshTokens = [];\n          }\n          // Generate refresh token that expires in 7 days\n          const refreshToken = generateRefreshToken();\n          // Remove any expired refresh tokens\n          account.refreshTokens = account.refreshTokens.filter(rt => !isTokenExpired(rt));\n          // Add new refresh token\n          account.refreshTokens.push(refreshToken);\n          localStorage.setItem(accountsKey, JSON.stringify(accounts));\n          const jwtToken = generateJwtToken(account);\n          return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n            jwtToken,\n            refreshToken\n          }));\n        } catch (error) {\n          console.error('Authentication error:', error);\n          return error('An error occurred during authentication');\n        }\n      }\n      function refreshToken() {\n        try {\n          // Get the current account from the stored accounts\n          const account = currentAccount();\n          if (!account) {\n            console.log('No authenticated account found');\n            return unauthorized();\n          }\n          // Check if account has any valid refresh tokens\n          if (!account.refreshTokens || account.refreshTokens.length === 0) {\n            console.log('No refresh tokens found for account');\n            return unauthorized();\n          }\n          // Get the most recent refresh token\n          const refreshToken = account.refreshTokens[account.refreshTokens.length - 1];\n          // Verify refresh token hasn't expired\n          if (isTokenExpired(refreshToken)) {\n            console.log('Refresh token has expired');\n            // Remove expired refresh token\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n            return unauthorized();\n          }\n          // Generate new tokens\n          const newRefreshToken = generateRefreshToken();\n          const jwtToken = generateJwtToken(account);\n          // Update refresh tokens - keep the current one until new one is confirmed\n          account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken && !isTokenExpired(x));\n          account.refreshTokens.push(newRefreshToken);\n          localStorage.setItem(accountsKey, JSON.stringify(accounts));\n          console.log('Token refresh successful');\n          return ok(Object.assign(Object.assign({}, basicDetails(account)), {\n            jwtToken,\n            refreshToken: newRefreshToken\n          }));\n        } catch (error) {\n          console.error('Refresh token error:', error);\n          return unauthorized();\n        }\n      }\n      function revokeToken() {\n        if (!isAuthenticated()) return unauthorized();\n        const refreshToken = body.refreshToken;\n        const account = accounts.find(x => {\n          var _a;\n          return (_a = x.refreshTokens) === null || _a === void 0 ? void 0 : _a.includes(refreshToken);\n        });\n        // revoke token and save\n        account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function register() {\n        const account = body;\n        if (accounts.find(x => x.email === account.email)) {\n          // display email already registered message in alert\n          setTimeout(() => {\n            alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, {\n              autoclose: false\n            });\n          }, 1000);\n          // always return ok() response to prevent email enumeration\n          return ok();\n        }\n        // assign account id and a few other properties then save\n        account.id = newAccountId();\n        if (account.id === 1) {\n          // first registered account is an admin\n          account.role = Role.Admin;\n          account.status = 'Active'; // Admin accounts get active status\n        } else {\n          account.role = Role.User;\n          account.status = 'Inactive'; // User accounts get inacitve status upon creation\n        }\n\n        account.dateCreated = new Date().toISOString();\n        account.verificationToken = new Date().getTime().toString();\n        account.isVerified = false;\n        account.refreshTokens = [];\n        delete account.confirmPassword;\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        // display verification email in alert\n        setTimeout(() => {\n          const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n          alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, {\n            autoclose: false\n          });\n        }, 1000);\n        return ok();\n      }\n      function verifyEmail() {\n        const {\n          token\n        } = body;\n        const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n        if (!account) return error('Verification failed');\n        // set is verified flag to true if token is valid\n        account.isVerified = true;\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n      function getAccounts() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(accounts.map(x => basicDetails(x)));\n      }\n      function getAccountById() {\n        if (!isAuthenticated()) return unauthorized();\n        let account = accounts.find(x => x.id === idFromUrl());\n        // user accounts can get own profile and admin accounts can get all profiles\n        if (account.id !== currentAccount().id && !isAdmin()) {\n          return unauthorized();\n        }\n        return ok(basicDetails(account));\n      }\n      // Request functions\n      function getRequests() {\n        if (!isAuthenticated()) return unauthorized();\n        // Only include objects that are true requests (have typeId or type matching requestTypes)\n        let filteredRequests = requests.filter(r => {\n          // Must have a typeId or a type that matches a requestType\n          return typeof r.typeId === 'number' || typeof r.type === 'string' && requestTypes.some(rt => rt.name === r.type);\n        });\n        if (!isAdmin()) {\n          const currentUserId = currentAccount().id;\n          filteredRequests = filteredRequests.filter(x => x.employeeId === currentUserId);\n        }\n        return ok(filteredRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const requestEmployee = employees.find(e => e.id === request.employeeId);\n          const requestAccount = accounts.find(a => a.id === (requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.accountId));\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          return {\n            id: request.id,\n            employeeId: (requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.employeeId) || '',\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type || '',\n            status: request.status,\n            createdDate: request.createdDate,\n            items: items,\n            employee: {\n              id: requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.id,\n              employeeId: requestEmployee === null || requestEmployee === void 0 ? void 0 : requestEmployee.employeeId,\n              fullName: requestAccount ? `${requestAccount.firstName} ${requestAccount.lastName}`.trim() : ''\n            }\n          };\n        }));\n      }\n      function getRequestById() {\n        if (!isAuthenticated()) return unauthorized();\n        const request = requests.find(x => x.id === idFromUrl());\n        if (!request) return notFound();\n        // Check authorization\n        if (!isAdmin() && request.employeeId !== currentAccount().id) {\n          return unauthorized();\n        }\n        // Add related data\n        const items = requestItems.filter(item => item.requestId === request.id);\n        const employee = employees.find(e => e.id === request.employeeId);\n        const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n        const requestType = requestTypes.find(t => t.id === request.typeId);\n        // Format employee name with proper capitalization\n        const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        const fullName = `${firstName} ${lastName}`.trim();\n        return ok(Object.assign(Object.assign({}, request), {\n          items: items.map(item => ({\n            id: item.id,\n            name: item.name,\n            quantity: item.quantity\n          })),\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            fullName: fullName,\n            employeeId: employee.employeeId\n          }) : null,\n          type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type\n        }));\n      }\n      function getRequestsByEmployeeId() {\n        if (!isAuthenticated()) return unauthorized();\n        const internalId = parseInt(url.split('/').pop());\n        console.log('Looking for requests with employeeId:', internalId);\n        const employee = employees.find(e => e.id === internalId);\n        if (!employee) {\n          console.log('Employee not found with internal id:', internalId);\n          return notFound();\n        }\n        const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n        console.log('Found requests:', employeeRequests.length);\n        // Sort requests in descending order by creation date\n        const sortedRequests = [...employeeRequests].sort((a, b) => {\n          const dateA = new Date(a.createdDate);\n          const dateB = new Date(b.createdDate);\n          return dateB.getTime() - dateA.getTime();\n        });\n        return ok(sortedRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          const account = accounts.find(a => a.id === employee.accountId);\n          // Format employee name with proper capitalization\n          const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n          const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n          const fullName = `${firstName} ${lastName}`.trim();\n          return {\n            id: request.id,\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type,\n            status: request.status,\n            createdDate: request.createdDate,\n            items: items,\n            employee: {\n              id: employee.id,\n              employeeId: employee.employeeId,\n              fullName: fullName\n            }\n          };\n        }));\n      }\n      function getMyRequests() {\n        if (!isAuthenticated()) return unauthorized();\n        const currentUserId = currentAccount().id;\n        const myRequests = requests.filter(x => x.employeeId === currentUserId);\n        return ok(myRequests.map(request => {\n          const items = requestItems.filter(item => item.requestId === request.id);\n          const employee = employees.find(e => e.id === request.employeeId);\n          const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          return Object.assign(Object.assign({}, request), {\n            items,\n            employee: employee ? Object.assign(Object.assign({}, employee), {\n              fullName: `${(account === null || account === void 0 ? void 0 : account.firstName) || ''} ${(account === null || account === void 0 ? void 0 : account.lastName) || ''}`.trim(),\n              employeeId: employee.employeeId\n            }) : null,\n            type: requestType ? requestType.name : request.type\n          });\n        }));\n      }\n      function createRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        console.log('Received request data:', body);\n        // Find employee by employeeId\n        let targetEmployee;\n        if (body.employeeId) {\n          // Try to find by internal ID first\n          const employeeIdNum = Number(body.employeeId);\n          targetEmployee = employees.find(e => e.id === employeeIdNum);\n          if (!targetEmployee) {\n            // If not found by internal ID, try to find by employee ID string\n            targetEmployee = employees.find(e => e.employeeId === body.employeeId);\n          }\n          if (!targetEmployee) {\n            console.error('Employee not found for ID:', body.employeeId);\n            return error('Employee not found');\n          }\n        } else {\n          // If no employeeId provided, use current user\n          const currentUser = currentAccount();\n          targetEmployee = employees.find(e => e.accountId === currentUser.id);\n          if (!targetEmployee) {\n            console.error('No employee found for current user');\n            return error('Current user is not an employee');\n          }\n        }\n        console.log('Target employee found:', targetEmployee);\n        const request = {\n          id: newRequestId(),\n          employeeId: targetEmployee.id,\n          typeId: body.typeId ? Number(body.typeId) : null,\n          type: body.type,\n          description: body.description || '',\n          status: 'Pending',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        console.log('Creating request:', request);\n        // Validate required fields\n        if (!request.type && !request.typeId) {\n          return error('Request type is required');\n        }\n        // Validate and process items if present\n        let requestItemsList = [];\n        if (body.items && Array.isArray(body.items)) {\n          try {\n            requestItemsList = body.items.map(item => {\n              if (!item.name || !item.quantity) {\n                throw new Error('Invalid item data');\n              }\n              return {\n                id: newRequestItemId(),\n                requestId: request.id,\n                name: item.name,\n                quantity: Number(item.quantity)\n              };\n            });\n          } catch (error) {\n            return error('Invalid item data provided');\n          }\n        }\n        // Save request and items\n        requests.push(request);\n        if (requestItemsList.length > 0) {\n          requestItems.push(...requestItemsList);\n          localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n        }\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        const account = accounts.find(a => a.id === targetEmployee.accountId);\n        const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        const fullName = `${firstName} ${lastName}`.trim();\n        const response = Object.assign(Object.assign({}, request), {\n          items: requestItemsList,\n          employee: {\n            id: targetEmployee.id,\n            employeeId: targetEmployee.employeeId,\n            fullName: fullName\n          }\n        });\n        console.log('Created request:', response);\n        return ok(response);\n      }\n      function updateRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        console.log('Received update data:', body);\n        const requestId = idFromUrl();\n        const request = requests.find(x => x.id === requestId);\n        if (!request) return notFound();\n        if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n        // Update basic request fields\n        Object.assign(request, {\n          type: body.type,\n          description: body.description || request.description,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Handle item changes\n        if (body.items) {\n          // Remove all existing items for this request\n          requestItems = requestItems.filter(item => item.requestId !== requestId);\n          // Add new/updated items\n          const newItems = body.items.map(item => ({\n            id: item.id || newRequestItemId(),\n            requestId: requestId,\n            name: item.name,\n            quantity: Number(item.quantity)\n          }));\n          requestItems.push(...newItems);\n          localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n        }\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        // Get related data for response\n        const employee = employees.find(e => e.id === request.employeeId);\n        const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n        const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        const fullName = `${firstName} ${lastName}`.trim();\n        return ok(Object.assign(Object.assign({}, request), {\n          items: requestItems.filter(item => item.requestId === requestId),\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            fullName: fullName,\n            employeeId: employee.employeeId\n          }) : null\n        }));\n      }\n      function changeRequestStatus() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const requestId = idFromUrl();\n        const request = requests.find(x => x.id === requestId);\n        if (!request) {\n          console.error('Request not found with ID:', requestId);\n          return notFound();\n        }\n        const newStatus = body.status;\n        if (!newStatus) {\n          console.error('No status provided in request body');\n          return error('Status is required');\n        }\n        // Validate status value\n        const validStatuses = ['Pending', 'Approved', 'Rejected', 'Cancelled'];\n        if (!validStatuses.includes(newStatus)) {\n          console.error('Invalid status value:', newStatus);\n          return error('Invalid status value');\n        }\n        try {\n          // Update request\n          request.status = newStatus;\n          request.lastModifiedDate = new Date().toISOString();\n          // Update requests array\n          const requestIndex = requests.findIndex(x => x.id === requestId);\n          if (requestIndex === -1) {\n            console.error('Request not found in array');\n            return error('Request not found');\n          }\n          requests[requestIndex] = request;\n          localStorage.setItem(requestsKey, JSON.stringify(requests));\n          // Get related data for response\n          const employee = employees.find(e => e.id === request.employeeId);\n          const account = accounts.find(a => a.id === (employee === null || employee === void 0 ? void 0 : employee.accountId));\n          const requestType = requestTypes.find(t => t.id === request.typeId);\n          const items = requestItems.filter(item => item.requestId === request.id);\n          // Format employee name\n          const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n          const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n          const fullName = `${firstName} ${lastName}`.trim();\n          const response = Object.assign(Object.assign({}, request), {\n            type: (requestType === null || requestType === void 0 ? void 0 : requestType.name) || request.type,\n            items: items,\n            employee: employee ? {\n              id: employee.id,\n              employeeId: employee.employeeId,\n              fullName: fullName\n            } : null\n          });\n          console.log('Request status updated successfully:', response);\n          return ok(response);\n        } catch (error) {\n          console.error('Error updating request status:', error);\n          return error('Failed to update request status');\n        }\n      }\n      function deleteRequest() {\n        if (!isAuthenticated()) return unauthorized();\n        const requestId = idFromUrl();\n        const request = requests.find(x => x.id === requestId);\n        if (!request) return notFound();\n        if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n        // Delete request and its items\n        requests = requests.filter(x => x.id !== requestId);\n        requestItems = requestItems.filter(x => x.requestId !== requestId);\n        localStorage.setItem(requestsKey, JSON.stringify(requests));\n        localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n        return ok();\n      }\n      // Employee functions\n      function getEmployees() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(employees.map(employee => {\n          const department = departments.find(d => d.id === employee.departmentId);\n          const account = accounts.find(a => a.id === employee.accountId);\n          // Format names with proper capitalization\n          const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n          const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n          return Object.assign(Object.assign({}, employee), {\n            employeeId: employee.employeeId,\n            fullName: `${firstName} ${lastName}`.trim(),\n            departmentName: (department === null || department === void 0 ? void 0 : department.name) || '',\n            department: department ? {\n              id: department.id,\n              name: department.name,\n              description: department.description\n            } : null,\n            account: account ? basicDetails(account) : null\n          });\n        }));\n      }\n      function getEmployeeById() {\n        if (!isAuthenticated()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employee = employees.find(x => x.id === employeeId);\n        if (!employee) return notFound();\n        // Get fresh department data\n        const department = departments.find(d => d.id === employee.departmentId);\n        if (!department) return error('Department not found');\n        const account = accounts.find(a => a.id === employee.accountId);\n        const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        // Return complete employee data with fresh relations\n        return ok(Object.assign(Object.assign({}, employee), {\n          employeeId: employee.employeeId,\n          fullName: `${firstName} ${lastName}`.trim(),\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      function createEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        // Log the received data for debugging\n        console.log('Received employee data:', body);\n        // Check if employee ID already exists\n        if (employees.find(x => x.employeeId === body.employeeId)) {\n          return error('Employee ID already exists');\n        }\n        // Validate department exists\n        const department = departments.find(d => d.id === Number(body.departmentId));\n        if (!department) return error('Department not found');\n        // Validate account exists and isn't already assigned to an employee\n        const account = accounts.find(a => a.id === Number(body.accountId));\n        if (!account) return error('Account not found');\n        if (employees.find(e => e.accountId === Number(body.accountId))) {\n          return error('Account is already assigned to another employee');\n        }\n        const employee = {\n          id: newEmployeeId(),\n          accountId: Number(body.accountId),\n          employeeId: body.employeeId,\n          departmentId: Number(body.departmentId),\n          position: body.position,\n          hireDate: body.hireDate,\n          salary: Number(body.salary),\n          status: body.status || 'Active',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        // Check each required field individually and log the result\n        const requiredFields = {\n          accountId: !!employee.accountId,\n          employeeId: !!employee.employeeId,\n          departmentId: !!employee.departmentId,\n          position: !!employee.position,\n          hireDate: !!employee.hireDate,\n          salary: !!employee.salary\n        };\n        console.log('Field validation results:', requiredFields);\n        // Check if any required field is missing\n        const missingFields = Object.entries(requiredFields).filter(([_, isValid]) => !isValid).map(([fieldName]) => fieldName);\n        if (missingFields.length > 0) {\n          return error(`Required fields are missing: ${missingFields.join(', ')}`);\n        }\n        // Format names\n        const firstName = account.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = account.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        // Create workflow entry for new employee\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employee.id,\n          type: 'Added',\n          details: {\n            task: `New employee ${employee.employeeId} was added`,\n            additionalInfo: `Added to ${department.name} department as ${employee.position}`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        employees.push(employee);\n        workflows.push(workflow);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, employee), {\n          fullName: `${firstName} ${lastName}`.trim(),\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          }\n        }));\n      }\n      function updateEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employeeIndex = employees.findIndex(x => x.id === employeeId);\n        if (employeeIndex === -1) return notFound();\n        const oldEmployee = employees[employeeIndex];\n        const updatedEmployee = Object.assign(Object.assign(Object.assign({}, oldEmployee), body), {\n          id: employeeId,\n          accountId: body.accountId ? Number(body.accountId) : oldEmployee.accountId,\n          departmentId: body.departmentId ? Number(body.departmentId) : oldEmployee.departmentId,\n          position: body.position || oldEmployee.position,\n          salary: body.salary ? Number(body.salary) : oldEmployee.salary,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate department exists if changed\n        if (body.departmentId) {\n          const department = departments.find(d => d.id === updatedEmployee.departmentId);\n          if (!department) return error('Department not found');\n        }\n        // Validate account exists if changed\n        if (body.accountId) {\n          const account = accounts.find(a => a.id === updatedEmployee.accountId);\n          if (!account) return error('Account not found');\n        }\n        const department = departments.find(d => d.id === updatedEmployee.departmentId);\n        const account = accounts.find(a => a.id === updatedEmployee.accountId);\n        // Create workflow entry for updated employee\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employeeId,\n          type: 'Updated',\n          details: {\n            task: `Employee ${employeeId} was updated`,\n            additionalInfo: `Updated in ${department.name} department`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        employees.push(updatedEmployee);\n        workflows.push(workflow);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, updatedEmployee), {\n          departmentName: department.name,\n          department: {\n            id: department.id,\n            name: department.name,\n            description: department.description\n          },\n          account: basicDetails(account)\n        }));\n      }\n      function deleteEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        const employeeIndex = employees.findIndex(x => x.id === employeeId);\n        if (employeeIndex === -1) return notFound();\n        const employee = employees[employeeIndex];\n        // Delete employee\n        employees = employees.filter(x => x.id !== employeeId);\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        return ok(Object.assign(Object.assign({}, employee), {\n          status: 'Deleted'\n        }));\n      }\n      function transferEmployee() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const employeeId = idFromUrl();\n        // Find the employee index\n        const employeeIndex = employees.findIndex(x => x.id === employeeId);\n        if (employeeIndex === -1) {\n          console.error('Employee not found:', employeeId);\n          return notFound();\n        }\n        // Get the current employee\n        const employee = employees[employeeIndex];\n        const oldDepartmentId = employee.departmentId;\n        const newDepartmentId = Number(body.departmentId);\n        // Validate departments exist\n        const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n        const newDepartment = departments.find(d => d.id === newDepartmentId);\n        if (!oldDepartment || !newDepartment) {\n          console.error('Department not found. Old:', oldDepartmentId, 'New:', newDepartmentId);\n          return error('Department not found');\n        }\n        // Don't do anything if the department hasn't changed\n        if (oldDepartmentId === newDepartmentId) {\n          console.log('Employee already in department:', newDepartmentId);\n          return error('Employee is already in this department');\n        }\n        console.log('Transferring employee', employee.employeeId, 'from', oldDepartment.name, 'to', newDepartment.name);\n        // Update the employee's department\n        employees[employeeIndex] = Object.assign(Object.assign({}, employee), {\n          departmentId: newDepartmentId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Get employee account for name\n        const account = accounts.find(a => a.id === employee.accountId);\n        const firstName = (account === null || account === void 0 ? void 0 : account.firstName) ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n        const lastName = (account === null || account === void 0 ? void 0 : account.lastName) ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n        // Create workflow entry for transfer\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: employeeId,\n          type: 'Transferred',\n          details: {\n            task: `Employee ${employee.employeeId} was transferred`,\n            additionalInfo: `From ${oldDepartment.name} to ${newDepartment.name} department`\n          },\n          status: 'Completed',\n          createdDate: new Date().toISOString(),\n          lastModifiedDate: new Date().toISOString()\n        };\n        workflows.push(workflow);\n        // Save changes\n        localStorage.setItem(employeesKey, JSON.stringify(employees));\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        console.log('Transfer completed successfully');\n        return ok(Object.assign(Object.assign({}, employees[employeeIndex]), {\n          fullName: `${firstName} ${lastName}`.trim(),\n          departmentName: newDepartment.name,\n          department: {\n            id: newDepartment.id,\n            name: newDepartment.name,\n            description: newDepartment.description\n          }\n        }));\n      }\n      // Department functions\n      function getDepartments() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(departments.map(department => {\n          return Object.assign(Object.assign({}, department), {\n            id: department.id.toString(),\n            name: department.name,\n            description: department.description\n          });\n        }));\n      }\n      function getDepartmentById() {\n        if (!isAuthenticated()) return unauthorized();\n        const departmentId = idFromUrl();\n        const department = departments.find(x => x.id === departmentId);\n        if (!department) return notFound();\n        return ok(Object.assign(Object.assign({}, department), {\n          id: department.id.toString(),\n          name: department.name,\n          description: department.description\n        }));\n      }\n      function createDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const department = body;\n        // Validate department name is unique\n        if (departments.find(x => x.name === department.name)) {\n          return error('Department name already exists');\n        }\n        // Assign department id and save\n        department.id = newDepartmentId();\n        departments.push(department);\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok(Object.assign(Object.assign({}, department), {\n          id: department.id.toString()\n        }));\n      }\n      function updateDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const departmentId = idFromUrl();\n        const departmentIndex = departments.findIndex(x => x.id === departmentId);\n        if (departmentIndex === -1) return notFound();\n        const oldDepartment = departments[departmentIndex];\n        const updatedDepartment = Object.assign(Object.assign(Object.assign({}, oldDepartment), body), {\n          id: departmentId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate department name is unique\n        if (departments.find(x => x.name === updatedDepartment.name && x.id !== updatedDepartment.id)) {\n          return error('Department name already exists');\n        }\n        departments.push(updatedDepartment);\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok(Object.assign(Object.assign({}, updatedDepartment), {\n          id: updatedDepartment.id.toString()\n        }));\n      }\n      function deleteDepartment() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const departmentId = idFromUrl();\n        const departmentIndex = departments.findIndex(x => x.id === departmentId);\n        if (departmentIndex === -1) return notFound();\n        const department = departments[departmentIndex];\n        // Delete department\n        departments = departments.filter(x => x.id !== departmentId);\n        localStorage.setItem(departmentsKey, JSON.stringify(departments));\n        return ok(Object.assign(Object.assign({}, department), {\n          status: 'Deleted'\n        }));\n      }\n      // Position functions\n      function getPositions() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(positions.map(position => {\n          return Object.assign(Object.assign({}, position), {\n            id: position.id.toString(),\n            name: position.name,\n            description: position.description\n          });\n        }));\n      }\n      function getPositionById() {\n        if (!isAuthenticated()) return unauthorized();\n        const positionId = idFromUrl();\n        const position = positions.find(x => x.id === positionId);\n        if (!position) return notFound();\n        return ok(Object.assign(Object.assign({}, position), {\n          id: position.id.toString(),\n          name: position.name,\n          description: position.description\n        }));\n      }\n      function createPosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const position = body;\n        // Validate position name is unique\n        if (positions.find(x => x.name === position.name)) {\n          return error('Position name already exists');\n        }\n        // Assign position id and save\n        position.id = newPositionId();\n        positions.push(position);\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok(Object.assign(Object.assign({}, position), {\n          id: position.id.toString()\n        }));\n      }\n      function updatePosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const positionId = idFromUrl();\n        const positionIndex = positions.findIndex(x => x.id === positionId);\n        if (positionIndex === -1) return notFound();\n        const oldPosition = positions[positionIndex];\n        const updatedPosition = Object.assign(Object.assign(Object.assign({}, oldPosition), body), {\n          id: positionId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate position name is unique\n        if (positions.find(x => x.name === updatedPosition.name && x.id !== updatedPosition.id)) {\n          return error('Position name already exists');\n        }\n        positions.push(updatedPosition);\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok(Object.assign(Object.assign({}, updatedPosition), {\n          id: updatedPosition.id.toString()\n        }));\n      }\n      function deletePosition() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const positionId = idFromUrl();\n        const positionIndex = positions.findIndex(x => x.id === positionId);\n        if (positionIndex === -1) return notFound();\n        const position = positions[positionIndex];\n        // Delete position\n        positions = positions.filter(x => x.id !== positionId);\n        localStorage.setItem(positionsKey, JSON.stringify(positions));\n        return ok(Object.assign(Object.assign({}, position), {\n          status: 'Deleted'\n        }));\n      }\n      // Request type functions\n      function getRequestTypes() {\n        if (!isAuthenticated()) return unauthorized();\n        return ok(requestTypes.map(type => {\n          return Object.assign(Object.assign({}, type), {\n            id: type.id.toString(),\n            name: type.name,\n            description: type.description\n          });\n        }));\n      }\n      function getRequestTypeById() {\n        if (!isAuthenticated()) return unauthorized();\n        const typeId = idFromUrl();\n        const type = requestTypes.find(x => x.id === typeId);\n        if (!type) return notFound();\n        return ok(Object.assign(Object.assign({}, type), {\n          id: type.id.toString(),\n          name: type.name,\n          description: type.description\n        }));\n      }\n      function createRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const type = body;\n        // Validate request type name is unique\n        if (requestTypes.find(x => x.name === type.name)) {\n          return error('Request type name already exists');\n        }\n        // Assign request type id and save\n        type.id = newRequestTypeId();\n        requestTypes.push(type);\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok(Object.assign(Object.assign({}, type), {\n          id: type.id.toString()\n        }));\n      }\n      function updateRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const typeId = idFromUrl();\n        const typeIndex = requestTypes.findIndex(x => x.id === typeId);\n        if (typeIndex === -1) return notFound();\n        const oldType = requestTypes[typeIndex];\n        const updatedType = Object.assign(Object.assign(Object.assign({}, oldType), body), {\n          id: typeId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate request type name is unique\n        if (requestTypes.find(x => x.name === updatedType.name && x.id !== updatedType.id)) {\n          return error('Request type name already exists');\n        }\n        requestTypes.push(updatedType);\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok(Object.assign(Object.assign({}, updatedType), {\n          id: updatedType.id.toString()\n        }));\n      }\n      function deleteRequestType() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const typeId = idFromUrl();\n        const typeIndex = requestTypes.findIndex(x => x.id === typeId);\n        if (typeIndex === -1) return notFound();\n        const type = requestTypes[typeIndex];\n        // Delete request type\n        requestTypes = requestTypes.filter(x => x.id !== typeId);\n        localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n        return ok(Object.assign(Object.assign({}, type), {\n          status: 'Deleted'\n        }));\n      }\n      // Workflow functions\n      function getWorkflows() {\n        if (!isAuthenticated()) return unauthorized();\n        // Only include objects that are true workflows (type is 'Added', 'Updated', or 'Transferred' and do NOT have request-like properties)\n        const workflowTypes = ['Added', 'Updated', 'Transferred'];\n        const sortedWorkflows = [...workflows].filter(wf => {\n          return typeof wf.type === 'string' && workflowTypes.includes(wf.type) && !('items' in wf) && !('typeId' in wf) && !('description' in wf);\n        }).sort((a, b) => {\n          const dateA = new Date(a.datetimecreated || a.createdDate);\n          const dateB = new Date(b.datetimecreated || b.createdDate);\n          return dateB.getTime() - dateA.getTime();\n        });\n        const result = sortedWorkflows.map(workflow => {\n          // Ensure details is a string\n          let details = '';\n          if (typeof workflow.details === 'object') {\n            details = workflow.details.task || '';\n            if (workflow.details.additionalInfo) {\n              details += ` - ${workflow.details.additionalInfo}`;\n            }\n          } else {\n            details = workflow.details || '';\n          }\n          // Always provide datetimecreated\n          const datetimecreated = workflow.datetimecreated || workflow.createdDate;\n          return {\n            id: workflow.id.toString(),\n            type: workflow.type,\n            details: details,\n            status: workflow.status,\n            datetimecreated: datetimecreated,\n            employeeId: workflow.employeeId\n          };\n        });\n        console.log('Workflows sent to frontend:', result);\n        return ok(result);\n      }\n      function getWorkflowById() {\n        if (!isAuthenticated()) return unauthorized();\n        const workflow = workflows.find(x => x.id === idFromUrl());\n        if (!workflow) return notFound();\n        const details = typeof workflow.details === 'object' ? `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` : workflow.details || '';\n        return ok({\n          id: workflow.id.toString(),\n          type: workflow.type,\n          details: details,\n          status: workflow.status,\n          datetimecreated: workflow.datetimecreated || workflow.createdDate\n        });\n      }\n      function getWorkflowsByRequestId() {\n        if (!isAuthenticated()) return unauthorized();\n        const requestId = idFromUrl();\n        console.log('Looking for workflows with requestId:', requestId);\n        const request = requests.find(x => x.id === requestId);\n        if (!request) {\n          console.log('Request not found with id:', requestId);\n          return notFound();\n        }\n        const requestWorkflows = workflows.filter(x => x.requestId === requestId);\n        console.log('Found workflows:', requestWorkflows.length);\n        // Sort workflows in descending order\n        const sortedWorkflows = [...requestWorkflows].sort((a, b) => {\n          const dateA = new Date(a.datetimecreated || a.createdDate);\n          const dateB = new Date(b.datetimecreated || b.createdDate);\n          return dateB.getTime() - dateA.getTime();\n        });\n        return ok(sortedWorkflows.map(workflow => {\n          const details = typeof workflow.details === 'object' ? `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` : workflow.details || '';\n          return {\n            id: workflow.id.toString(),\n            type: workflow.type,\n            details: details,\n            status: workflow.status,\n            datetimecreated: workflow.datetimecreated || workflow.createdDate\n          };\n        }));\n      }\n      function createWorkflow() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        console.log('Received workflow data:', body);\n        // Format details as a string\n        let details = '';\n        if (typeof body.details === 'object') {\n          details = body.details.task || '';\n          if (body.details.additionalInfo) {\n            details += ` - ${body.details.additionalInfo}`;\n          }\n        } else {\n          details = body.details || '';\n        }\n        const now = new Date().toISOString();\n        const workflow = {\n          id: newWorkflowId(),\n          employeeId: body.employeeId,\n          type: body.type,\n          details: details,\n          status: 'ForReviewing',\n          createdDate: now,\n          datetimecreated: now,\n          lastModifiedDate: now\n        };\n        // Validate required fields\n        const requiredFields = {\n          employeeId: !!workflow.employeeId,\n          type: !!workflow.type,\n          details: !!workflow.details,\n          status: !!workflow.status\n        };\n        console.log('Field validation results:', requiredFields);\n        // Check if any required field is missing\n        const missingFields = Object.entries(requiredFields).filter(([_, isValid]) => !isValid).map(([fieldName]) => fieldName);\n        if (missingFields.length > 0) {\n          return error(`Required fields are missing: ${missingFields.join(', ')}`);\n        }\n        // Validate employee exists\n        const employee = employees.find(e => e.id === workflow.employeeId);\n        if (!employee) return error('Employee not found');\n        workflows.push(workflow);\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, workflow), {\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            employeeId: employee.employeeId\n          }) : null\n        }));\n      }\n      function updateWorkflow() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n        if (workflowIndex === -1) return notFound();\n        const oldWorkflow = workflows[workflowIndex];\n        const updatedWorkflow = Object.assign(Object.assign(Object.assign({}, oldWorkflow), body), {\n          id: workflowId,\n          lastModifiedDate: new Date().toISOString()\n        });\n        // Validate employee exists\n        const employee = employees.find(e => e.id === updatedWorkflow.employeeId);\n        if (!employee) return error('Employee not found');\n        workflows[workflowIndex] = updatedWorkflow;\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, updatedWorkflow), {\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            employeeId: employee.employeeId\n          }) : null\n        }));\n      }\n      function updateWorkflowStatus() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflow = workflows.find(x => x.id === workflowId);\n        if (!workflow) return notFound();\n        const newStatus = body.status;\n        Object.assign(workflow, {\n          status: newStatus,\n          lastModifiedDate: new Date().toISOString()\n        });\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, workflow), {\n          status: newStatus\n        }));\n      }\n      function deleteWorkflow() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n        if (workflowIndex === -1) return notFound();\n        const workflow = workflows[workflowIndex];\n        const employee = employees.find(e => e.id === workflow.employeeId);\n        // Delete workflow\n        workflows = workflows.filter(x => x.id !== workflowId);\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, workflow), {\n          employee: employee ? Object.assign(Object.assign({}, employee), {\n            employeeId: employee.employeeId\n          }) : null\n        }));\n      }\n      function deleteWorkflowItem() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const workflowId = idFromUrl();\n        const workflow = workflows.find(x => x.id === workflowId);\n        if (!workflow) return notFound();\n        // Delete workflow item\n        workflows = workflows.filter(x => x.id !== workflowId);\n        localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n        return ok(Object.assign(Object.assign({}, workflow), {\n          status: 'Deleted'\n        }));\n      }\n      function createAccount() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const account = body;\n        if (accounts.find(x => x.email === account.email)) {\n          return error('Email already exists');\n        }\n        account.id = newAccountId();\n        account.dateCreated = new Date().toISOString();\n        account.isVerified = true;\n        account.refreshTokens = [];\n        accounts.push(account);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(basicDetails(account));\n      }\n      function updateAccount() {\n        if (!isAuthenticated()) return unauthorized();\n        const accountId = idFromUrl();\n        const account = accounts.find(x => x.id === accountId);\n        if (!account) return notFound();\n        if (account.id !== currentAccount().id && !isAdmin()) return unauthorized();\n        // Only allow admins to update role\n        if (!isAdmin()) {\n          delete body.role;\n        }\n        // If email is being changed, make sure it's not already taken\n        if (body.email && body.email !== account.email && accounts.find(x => x.email === body.email)) {\n          return error('Email already exists');\n        }\n        Object.assign(account, body);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok(basicDetails(account));\n      }\n      function deleteAccount() {\n        if (!isAuthenticated() || !isAdmin()) return unauthorized();\n        const accountId = idFromUrl();\n        const account = accounts.find(x => x.id === accountId);\n        if (!account) return notFound();\n        if (account.id === currentAccount().id) return error('You cannot delete your own account');\n        accounts = accounts.filter(x => x.id !== accountId);\n        localStorage.setItem(accountsKey, JSON.stringify(accounts));\n        return ok();\n      }\n    }\n  }\n  FakeBackendInterceptor.ɵfac = function FakeBackendInterceptor_Factory(t) {\n    return new (t || FakeBackendInterceptor)(i0.ɵɵinject(i1.AlertService));\n  };\n  FakeBackendInterceptor.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: FakeBackendInterceptor,\n    factory: FakeBackendInterceptor.ɵfac\n  });\n  return FakeBackendInterceptor;\n})();\nexport const fakeBackendProvider = {\n  // use fake backend in place of Http service for backend-less development\n  provide: HTTP_INTERCEPTORS,\n  useClass: FakeBackendInterceptor,\n  multi: true\n};","map":{"version":3,"mappings":"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","names":["HttpResponse","HTTP_INTERCEPTORS","of","throwError","delay","materialize","dematerialize","Role","accountsKey","accounts","JSON","parse","localStorage","getItem","employeesKey","employees","departmentsKey","departments","id","name","description","requestsKey","requests","requestItemsKey","requestItems","workflowsKey","workflows","positionsKey","positions","requestTypesKey","requestTypes","newAccountId","length","Math","max","map","x","newRequestId","newRequestItemId","newEmployeeId","newWorkflowId","newDepartmentId","newPositionId","newRequestTypeId","generateJwtToken","account","header","btoa","stringify","alg","typ","now","Date","getTime","payload","role","email","iat","exp","payloadBase64","signature","error","console","generateRefreshToken","random","toString","substr","isTokenExpired","token","parts","split","atob","FakeBackendInterceptor","constructor","alertService","intercept","request","next","url","method","headers","body","ok","status","message","unauthorized","notFound","basicDetails","title","firstName","lastName","isVerified","isAuthenticated","authHeader","get","startsWith","log","find","isAdmin","Admin","currentAccount","idFromUrl","urlParts","parseInt","getWorkflowsByEmployeeId","internalId","pop","workflowTypes","employeeWorkflows","filter","wf","employeeId","type","includes","sortedWorkflows","sort","a","b","dateA","datetimecreated","createdDate","dateB","workflow","details","task","additionalInfo","handleRoute","pipe","endsWith","authenticate","refreshToken","revokeToken","register","verifyEmail","getAccounts","match","getAccountById","createAccount","updateAccount","deleteAccount","getRequests","getRequestById","getRequestsByEmployeeId","getMyRequests","createRequest","updateRequest","changeRequestStatus","deleteRequest","getEmployees","getEmployeeById","createEmployee","updateEmployee","deleteEmployee","transferEmployee","getDepartments","getDepartmentById","createDepartment","updateDepartment","deleteDepartment","getPositions","getPositionById","createPosition","updatePosition","deletePosition","getRequestTypes","getRequestTypeById","createRequestType","updateRequestType","deleteRequestType","getWorkflows","getWorkflowById","getWorkflowsByRequestId","createWorkflow","updateWorkflow","updateWorkflowStatus","deleteWorkflow","deleteWorkflowItem","handle","password","refreshTokens","rt","push","setItem","jwtToken","newRefreshToken","setTimeout","info","location","origin","autoclose","User","dateCreated","toISOString","verificationToken","confirmPassword","verifyUrl","filteredRequests","r","typeId","some","currentUserId","items","item","requestId","requestEmployee","e","requestAccount","accountId","requestType","t","employee","fullName","trim","charAt","toUpperCase","slice","toLowerCase","quantity","Object","employeeRequests","sortedRequests","myRequests","targetEmployee","employeeIdNum","Number","currentUser","lastModifiedDate","requestItemsList","Array","isArray","Error","response","assign","newItems","newStatus","validStatuses","requestIndex","findIndex","department","d","departmentId","departmentName","position","hireDate","salary","requiredFields","missingFields","entries","_","isValid","fieldName","join","employeeIndex","oldEmployee","updatedEmployee","oldDepartmentId","oldDepartment","newDepartment","departmentIndex","updatedDepartment","positionId","positionIndex","oldPosition","updatedPosition","typeIndex","oldType","updatedType","result","requestWorkflows","workflowId","workflowIndex","oldWorkflow","updatedWorkflow","factory","fakeBackendProvider","provide","useClass","multi"],"sourceRoot":"","sources":["D:\\JiM\\School\\3rd Year\\2nd Semester\\SUBJECTS\\IT-INTPROG32\\Coding (INTPROG32)\\Final\\project7\\frontend\\src\\app\\_helpers\\fake-backend.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpRequest, HttpResponse, HttpHandler, HttpEvent, HttpInterceptor, HTTP_INTERCEPTORS, HttpHeaders } from '@angular/common/http';\nimport { Observable, of, throwError } from 'rxjs';\nimport { delay, materialize, dematerialize } from 'rxjs/operators';\n\nimport { AlertService } from '@app/_services';\nimport { Role } from '@app/_models';\n\n// array in local storage for accounts\nconst accountsKey = 'request-management-accounts';\nlet accounts = JSON.parse(localStorage.getItem(accountsKey)) || [];\n\n// array in local storage for employees\nconst employeesKey = 'request-management-employees';\nlet employees = JSON.parse(localStorage.getItem(employeesKey)) || [];\n\n// array in local storage for departments\nconst departmentsKey = 'request-management-departments';\nlet departments = JSON.parse(localStorage.getItem(departmentsKey)) || [\n    { id: 1, name: 'HR', description: 'Human Resources' },\n    { id: 2, name: 'IT', description: 'Information Technology' },\n    { id: 3, name: 'Finance', description: 'Finance Department' },\n    { id: 4, name: 'Marketing', description: 'Marketing Department' }\n];\n\n// array in local storage for requests and their items\nconst requestsKey = 'request-management-requests';\nlet requests = JSON.parse(localStorage.getItem(requestsKey)) || [];\n\n// array in local storage for request items\nconst requestItemsKey = 'request-management-items';\nlet requestItems = JSON.parse(localStorage.getItem(requestItemsKey)) || [];\n\n// array in local storage for workflows\nconst workflowsKey = 'request-management-workflows';\nlet workflows = JSON.parse(localStorage.getItem(workflowsKey)) || [];\n\n// array in local storage for employee positions\nconst positionsKey = 'request-management-positions';\nlet positions = JSON.parse(localStorage.getItem(positionsKey)) || [\n    { id: 1, name: 'Manager', description: 'Department Manager' },\n    { id: 2, name: 'Team Lead', description: 'Team Leader' },\n    { id: 3, name: 'Senior Staff', description: 'Senior Level Staff' },\n    { id: 4, name: 'Junior Staff', description: 'Junior Level Staff' }\n];\n\n// array in local storage for request types\nconst requestTypesKey = 'request-management-request-types';\nlet requestTypes = JSON.parse(localStorage.getItem(requestTypesKey)) || [\n    { id: 1, name: 'Leave Request', description: 'Request for leave or time off' },\n    { id: 2, name: 'Equipment Request', description: 'Request for office equipment' },\n    { id: 3, name: 'Training Request', description: 'Request for training or workshops' },\n    { id: 4, name: 'Other', description: 'Other types of requests' }\n];\n\n// Helper functions for generating IDs\nfunction newAccountId(): number {\n    return accounts.length ? Math.max(...accounts.map(x => x.id)) + 1 : 1;\n}\n\nfunction newRequestId(): number {\n    return requests.length ? Math.max(...requests.map(x => x.id)) + 1 : 1;\n}\n\nfunction newRequestItemId(): number {\n    return requestItems.length ? Math.max(...requestItems.map(x => x.id)) + 1 : 1;\n}\n\nfunction newEmployeeId(): number {\n    return employees.length ? Math.max(...employees.map(x => x.id)) + 1 : 1;\n}\n\nfunction newWorkflowId(): number {\n    return workflows.length ? Math.max(...workflows.map(x => x.id)) + 1 : 1;\n}\n\nfunction newDepartmentId(): number {\n    return departments.length ? Math.max(...departments.map(x => x.id)) + 1 : 1;\n}\n\nfunction newPositionId(): number {\n    return positions.length ? Math.max(...positions.map(x => x.id)) + 1 : 1;\n}\n\nfunction newRequestTypeId(): number {\n    return requestTypes.length ? Math.max(...requestTypes.map(x => x.id)) + 1 : 1;\n}\n\n// Helper functions for JWT and refresh tokens\nfunction generateJwtToken(account: any): string {\n    try {\n        const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\n        const now = new Date().getTime();\n        const payload = {\n            id: account.id,\n            role: account.role,\n            email: account.email,\n            iat: now,\n            exp: now + (24 * 60 * 60 * 1000) // 24 hours expiry\n        };\n        const payloadBase64 = btoa(JSON.stringify(payload));\n        const signature = btoa('fake-jwt-secret-key');\n        return `${header}.${payloadBase64}.${signature}`;\n    } catch (error) {\n        console.error('Error generating JWT token:', error);\n        throw error;\n    }\n}\n\nfunction generateRefreshToken(): string {\n    try {\n        const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\n        const now = new Date().getTime();\n        const payload = {\n            id: Math.random().toString(36).substr(2),\n            iat: now,\n            exp: now + (7 * 24 * 60 * 60 * 1000) // 7 days expiry\n        };\n        const payloadBase64 = btoa(JSON.stringify(payload));\n        const signature = btoa('fake-refresh-secret-key');\n        return `${header}.${payloadBase64}.${signature}`;\n    } catch (error) {\n        console.error('Error generating refresh token:', error);\n        throw error;\n    }\n}\n\nfunction isTokenExpired(token: string): boolean {\n    if (!token) return true;\n    \n    try {\n        const parts = token.split('.');\n        if (parts.length !== 3) return true;\n        \n        const payload = JSON.parse(atob(parts[1]));\n        if (!payload || typeof payload.exp !== 'number') return true;\n        \n        return payload.exp < new Date().getTime();\n    } catch (error) {\n        console.error('Error checking token expiration:', error);\n        return true;\n    }\n}\n\n@Injectable()\nexport class FakeBackendInterceptor implements HttpInterceptor {\n    constructor(private alertService: AlertService) { }\n\n    intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n        const { url, method, headers, body } = request;\n        const alertService = this.alertService;\n\n        // Helper functions\n        function ok(body?: any) {\n            return of(new HttpResponse({ status: 200, body }));\n        }\n\n        function error(message: string) {\n            return throwError(() => ({ error: { message } }));\n        }\n\n        function unauthorized() {\n            return throwError(() => ({ status: 401, error: { message: 'Unauthorized' } }));\n        }\n\n        function notFound() {\n            return throwError(() => ({ status: 404, error: { message: 'Not Found' } }));\n        }\n\n        function basicDetails(account: any) {\n            const { id, title, firstName, lastName, email, role, status, isVerified } = account;\n            return { id, title, firstName, lastName, email, role, status, isVerified };\n        }\n\n        function isAuthenticated() {\n            try {\n                const authHeader = headers.get('Authorization');\n                if (!authHeader?.startsWith('Bearer ')) return false;\n                \n                const token = authHeader.split(' ')[1];\n                if (isTokenExpired(token)) {\n                    console.log('JWT token has expired');\n                    return false;\n                }\n                \n                const parts = token.split('.');\n                const payload = JSON.parse(atob(parts[1]));\n                const account = accounts.find(x => x.id === payload.id);\n                \n                return !!account;\n            } catch (error) {\n                console.error('Authentication check error:', error);\n                return false;\n            }\n        }\n\n        function isAdmin() {\n            return currentAccount()?.role === Role.Admin;\n        }\n\n        function currentAccount() {\n            if (!isAuthenticated()) return null;\n            \n            try {\n                const authHeader = headers.get('Authorization');\n                if (!authHeader?.startsWith('Bearer ')) return null;\n                \n                const token = authHeader.split(' ')[1];\n                const parts = token.split('.');\n                const payload = JSON.parse(atob(parts[1]));\n                \n                // Find account by ID from token payload\n                const account = accounts.find(x => x.id === payload.id);\n                if (!account) {\n                    console.log('No account found for token payload ID:', payload.id);\n                    return null;\n                }\n                \n                return account;\n            } catch (error) {\n                console.error('Error getting current account:', error);\n                return null;\n            }\n        }\n\n        function idFromUrl() {\n            const urlParts = url.split('/');\n            // Handle URLs that end with /status\n            if (urlParts[urlParts.length - 1] === 'status') {\n                return parseInt(urlParts[urlParts.length - 2]);\n            }\n            return parseInt(urlParts[urlParts.length - 1]);\n        }\n\n        function getWorkflowsByEmployeeId() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const internalId = parseInt(url.split('/').pop());\n            console.log('Looking for workflows with employeeId:', internalId);\n\n            // Only include objects that are true workflows (type is 'Added', 'Updated', or 'Transferred' and do NOT have request-like properties)\n            const workflowTypes = ['Added', 'Updated', 'Transferred'];\n            const employeeWorkflows = workflows.filter(wf => {\n                return (\n                    wf.employeeId === internalId &&\n                    typeof wf.type === 'string' &&\n                    workflowTypes.includes(wf.type) &&\n                    !('items' in wf) &&\n                    !('typeId' in wf) &&\n                    !('description' in wf)\n                );\n            });\n            console.log('Found workflows:', employeeWorkflows.length);\n\n            // Sort workflows in descending order by creation date\n            const sortedWorkflows = [...employeeWorkflows].sort((a, b) => {\n                const dateA = new Date(a.datetimecreated || a.createdDate);\n                const dateB = new Date(b.datetimecreated || b.createdDate);\n                return dateB.getTime() - dateA.getTime();\n            });\n\n            return ok(sortedWorkflows.map(workflow => {\n                // Ensure details is a string\n                let details = '';\n                if (typeof workflow.details === 'object') {\n                    details = workflow.details.task || '';\n                    if (workflow.details.additionalInfo) {\n                        details += ` - ${workflow.details.additionalInfo}`;\n                    }\n                } else {\n                    details = workflow.details || '';\n                }\n                // Always provide datetimecreated\n                const datetimecreated = workflow.datetimecreated || workflow.createdDate;\n                return {\n                    id: workflow.id.toString(),\n                    type: workflow.type,\n                    details: details,\n                    status: workflow.status,\n                    datetimecreated: datetimecreated,\n                    employeeId: workflow.employeeId\n                };\n            }));\n        }\n\n        return handleRoute().pipe(\n            delay(500),\n            materialize(),\n            dematerialize()\n        );\n\n        function handleRoute() {\n            switch (true) {\n                case url.endsWith('/accounts/authenticate') && method === 'POST':\n                    return authenticate();\n                case url.endsWith('/accounts/refresh-token') && method === 'POST':\n                    return refreshToken();\n                case url.endsWith('/accounts/revoke-token') && method === 'POST':\n                    return revokeToken();\n                case url.endsWith('/accounts/register') && method === 'POST':\n                    return register();\n                case url.endsWith('/accounts/verify-email') && method === 'POST':\n                    return verifyEmail();\n                case url.endsWith('/accounts') && method === 'GET':\n                    return getAccounts();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'GET':\n                    return getAccountById();\n                case url.endsWith('/accounts') && method === 'POST':\n                    return createAccount();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'PUT':\n                    return updateAccount();\n                case url.match(/\\/accounts\\/\\d+$/) && method === 'DELETE':\n                    return deleteAccount();\n                    \n                // request routes\n                case url.endsWith('/requests') && method === 'GET':\n                    return getRequests();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'GET':\n                    return getRequestById();\n                case url.match(/\\/requests\\/employee\\/\\d+$/) && method === 'GET':\n                    return getRequestsByEmployeeId();\n                case url.endsWith('/requests/my-requests') && method === 'GET':\n                    return getMyRequests();\n                case url.endsWith('/requests') && method === 'POST':\n                    return createRequest();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'PUT':\n                    return updateRequest();\n                case url.match(/\\/requests\\/\\d+\\/status$/) && method === 'PUT':\n                    return changeRequestStatus();\n                case url.match(/\\/requests\\/\\d+$/) && method === 'DELETE':\n                    return deleteRequest();\n                    \n                // employee routes\n                case url.endsWith('/employees') && method === 'GET':\n                    return getEmployees();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'GET':\n                    return getEmployeeById();\n                case url.endsWith('/employees') && method === 'POST':\n                    return createEmployee();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'PUT':\n                    return updateEmployee();\n                case url.match(/\\/employees\\/\\d+$/) && method === 'DELETE':\n                    return deleteEmployee();\n                case url.match(/\\/employees\\/\\d+\\/transfer$/) && method === 'PUT':\n                    return transferEmployee();\n\n                // department routes\n                case url.endsWith('/departments') && method === 'GET':\n                    return getDepartments();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'GET':\n                    return getDepartmentById();\n                case url.endsWith('/departments') && method === 'POST':\n                    return createDepartment();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'PUT':\n                    return updateDepartment();\n                case url.match(/\\/departments\\/\\d+$/) && method === 'DELETE':\n                    return deleteDepartment();\n                    \n                // position routes\n                case url.endsWith('/positions') && method === 'GET':\n                    return getPositions();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'GET':\n                    return getPositionById();\n                case url.endsWith('/positions') && method === 'POST':\n                    return createPosition();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'PUT':\n                    return updatePosition();\n                case url.match(/\\/positions\\/\\d+$/) && method === 'DELETE':\n                    return deletePosition();\n\n                // request type routes\n                case url.endsWith('/request-types') && method === 'GET':\n                    return getRequestTypes();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'GET':\n                    return getRequestTypeById();\n                case url.endsWith('/request-types') && method === 'POST':\n                    return createRequestType();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'PUT':\n                    return updateRequestType();\n                case url.match(/\\/request-types\\/\\d+$/) && method === 'DELETE':\n                    return deleteRequestType();\n\n                // workflow routes\n                case url.endsWith('/workflows') && method === 'GET':\n                    return getWorkflows();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'GET':\n                    return getWorkflowById();\n                case url.match(/\\/workflows\\/employee\\/\\d+$/) && method === 'GET':\n                    return getWorkflowsByEmployeeId();\n                case url.match(/\\/workflows\\/request\\/\\d+$/) && method === 'GET':\n                    return getWorkflowsByRequestId();\n                case url.endsWith('/workflows') && method === 'POST':\n                    return createWorkflow();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'PUT':\n                    return updateWorkflow();\n                case url.match(/\\/workflows\\/\\d+\\/status$/) && method === 'PUT':\n                    return updateWorkflowStatus();\n                case url.match(/\\/workflows\\/\\d+$/) && method === 'DELETE':\n                    return deleteWorkflow();\n                case url.match(/\\/workflows\\/items\\/\\d+$/) && method === 'DELETE':\n                    return deleteWorkflowItem();\n                    \n                default:\n                    return next.handle(request);\n            }\n        }\n\n        // Authentication functions\n        function authenticate() {\n            const { email, password } = body;\n            const account = accounts.find(x => x.email === email);\n        \n            if (!account) return error('Email or password is incorrect');\n            if (password !== account.password) return error('Email or password is incorrect');\n            if (!account.isVerified) return error('Please verify your email before logging in');\n\n            try {\n                // Initialize refreshTokens array if it doesn't exist\n                if (!account.refreshTokens) {\n                    account.refreshTokens = [];\n                }\n\n                // Generate refresh token that expires in 7 days\n                const refreshToken = generateRefreshToken();\n                \n                // Remove any expired refresh tokens\n                account.refreshTokens = account.refreshTokens.filter(rt => !isTokenExpired(rt));\n                \n                // Add new refresh token\n                account.refreshTokens.push(refreshToken);\n                localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n                const jwtToken = generateJwtToken(account);\n        \n                return ok({\n                    ...basicDetails(account),\n                    jwtToken,\n                    refreshToken\n                });\n            } catch (error) {\n                console.error('Authentication error:', error);\n                return error('An error occurred during authentication');\n            }\n        }\n\n        function refreshToken() {\n            try {\n                // Get the current account from the stored accounts\n                const account = currentAccount();\n                if (!account) {\n                    console.log('No authenticated account found');\n                    return unauthorized();\n                }\n\n                // Check if account has any valid refresh tokens\n                if (!account.refreshTokens || account.refreshTokens.length === 0) {\n                    console.log('No refresh tokens found for account');\n                    return unauthorized();\n                }\n\n                // Get the most recent refresh token\n                const refreshToken = account.refreshTokens[account.refreshTokens.length - 1];\n                \n                // Verify refresh token hasn't expired\n                if (isTokenExpired(refreshToken)) {\n                    console.log('Refresh token has expired');\n                    // Remove expired refresh token\n                    account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n                    localStorage.setItem(accountsKey, JSON.stringify(accounts));\n                    return unauthorized();\n                }\n\n                // Generate new tokens\n                const newRefreshToken = generateRefreshToken();\n                const jwtToken = generateJwtToken(account);\n\n                // Update refresh tokens - keep the current one until new one is confirmed\n                account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken && !isTokenExpired(x));\n                account.refreshTokens.push(newRefreshToken);\n                localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n                console.log('Token refresh successful');\n                return ok({\n                    ...basicDetails(account),\n                    jwtToken,\n                    refreshToken: newRefreshToken\n                });\n            } catch (error) {\n                console.error('Refresh token error:', error);\n                return unauthorized();\n            }\n        }\n\n        function revokeToken() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const refreshToken = body.refreshToken;\n            const account = accounts.find(x => x.refreshTokens?.includes(refreshToken));\n\n            // revoke token and save\n            account.refreshTokens = account.refreshTokens.filter(x => x !== refreshToken);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function register() {\n            const account = body;\n\n            if (accounts.find(x => x.email === account.email)) {\n                // display email already registered message in alert\n                setTimeout(() => {\n                    alertService.info(`\n                        <h4>Email Already Registered</h4>\n                        <p>Your email ${account.email} is already registered.</p>\n                        <p>If you don't know your password please visit the <a href=\"${location.origin}/account/forgot-password\">forgot password</a> page.</p>\n                        <div>\n                        <strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.\n                        </div>\n                    `, { autoclose: false });\n                }, 1000);\n\n                // always return ok() response to prevent email enumeration\n                return ok();\n            }\n\n            // assign account id and a few other properties then save\n            account.id = newAccountId();\n            if (account.id === 1) {\n                // first registered account is an admin\n                account.role = Role.Admin;\n                account.status = 'Active'; // Admin accounts get active status\n            } else {\n                account.role = Role.User;\n                account.status = 'Inactive'; // User accounts get inacitve status upon creation\n            }\n            account.dateCreated = new Date().toISOString();\n            account.verificationToken = new Date().getTime().toString();\n            account.isVerified = false;\n            account.refreshTokens = [];\n            delete account.confirmPassword;\n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            // display verification email in alert\n            setTimeout(() => {\n                const verifyUrl = `${location.origin}/account/verify-email?token=${account.verificationToken}`;\n                alertService.info(`\n                    <h4>Verification Email</h4>\n                    <p>Thanks for registering!</p>\n                    <p>Please click the below link to verify your email address:</p>\n                    <p><a href=\"${verifyUrl}\">${verifyUrl}</a></p>\n                    <div><strong>NOTE:</strong> The fake backend displayed this \"email\" so you can test without an API. A real backend would send a real email.</div>\n                `, { autoclose: false });\n            }, 1000);\n\n            return ok();\n        }\n\n        function verifyEmail() {\n            const { token } = body;\n            const account = accounts.find(x => !!x.verificationToken && x.verificationToken === token);\n\n            if (!account) return error('Verification failed');\n\n            // set is verified flag to true if token is valid\n            account.isVerified = true;\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n\n            return ok();\n        }\n\n        function getAccounts() {\n            if (!isAuthenticated()) return unauthorized();\n            return ok(accounts.map(x => basicDetails(x)));\n        }\n\n        function getAccountById() {\n            if (!isAuthenticated()) return unauthorized();\n\n            let account = accounts.find(x => x.id === idFromUrl());\n\n            // user accounts can get own profile and admin accounts can get all profiles\n            if (account.id !== currentAccount().id && !isAdmin()) {\n                return unauthorized();\n            }\n\n            return ok(basicDetails(account));\n        }\n\n        // Request functions\n        function getRequests() {\n            if (!isAuthenticated()) return unauthorized();\n\n            // Only include objects that are true requests (have typeId or type matching requestTypes)\n            let filteredRequests = requests.filter(r => {\n                // Must have a typeId or a type that matches a requestType\n                return (typeof r.typeId === 'number') || (typeof r.type === 'string' && requestTypes.some(rt => rt.name === r.type));\n            });\n            if (!isAdmin()) {\n                const currentUserId = currentAccount().id;\n                filteredRequests = filteredRequests.filter(x => x.employeeId === currentUserId);\n            }\n\n            return ok(filteredRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const requestEmployee = employees.find(e => e.id === request.employeeId);\n                const requestAccount = accounts.find(a => a.id === requestEmployee?.accountId);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n\n                return {\n                    id: request.id,\n                    employeeId: requestEmployee?.employeeId || '',\n                    type: requestType?.name || request.type || '',\n                    status: request.status,\n                    createdDate: request.createdDate,\n                    items: items,\n                    employee: {\n                        id: requestEmployee?.id,\n                        employeeId: requestEmployee?.employeeId,\n                        fullName: requestAccount ? `${requestAccount.firstName} ${requestAccount.lastName}`.trim() : ''\n                    }\n                };\n            }));\n        }\n\n        function getRequestById() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const request = requests.find(x => x.id === idFromUrl());\n            if (!request) return notFound();\n\n            // Check authorization\n            if (!isAdmin() && request.employeeId !== currentAccount().id) {\n                return unauthorized();\n            }\n\n            // Add related data\n            const items = requestItems.filter(item => item.requestId === request.id);\n            const employee = employees.find(e => e.id === request.employeeId);\n            const account = accounts.find(a => a.id === employee?.accountId);\n            const requestType = requestTypes.find(t => t.id === request.typeId);\n\n            // Format employee name with proper capitalization\n            const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            const fullName = `${firstName} ${lastName}`.trim();\n\n            return ok({\n                ...request,\n                items: items.map(item => ({\n                    id: item.id,\n                    name: item.name,\n                    quantity: item.quantity\n                })),\n                employee: employee ? {\n                    ...employee,\n                    fullName: fullName,\n                    employeeId: employee.employeeId\n                } : null,\n                type: requestType?.name || request.type\n            });\n        }\n\n        function getRequestsByEmployeeId() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const internalId = parseInt(url.split('/').pop());\n            console.log('Looking for requests with employeeId:', internalId);\n\n            const employee = employees.find(e => e.id === internalId);\n            if (!employee) {\n                console.log('Employee not found with internal id:', internalId);\n                return notFound();\n            }\n            \n            const employeeRequests = requests.filter(x => x.employeeId === employee.id);\n            console.log('Found requests:', employeeRequests.length);\n\n            // Sort requests in descending order by creation date\n            const sortedRequests = [...employeeRequests].sort((a, b) => {\n                const dateA = new Date(a.createdDate);\n                const dateB = new Date(b.createdDate);\n                return dateB.getTime() - dateA.getTime();\n            });\n\n            return ok(sortedRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                const account = accounts.find(a => a.id === employee.accountId);\n                \n                // Format employee name with proper capitalization\n                const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n                const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n                const fullName = `${firstName} ${lastName}`.trim();\n\n                return {\n                    id: request.id,\n                    type: requestType?.name || request.type,\n                    status: request.status,\n                    createdDate: request.createdDate,\n                    items: items,\n                    employee: {\n                        id: employee.id,\n                        employeeId: employee.employeeId,\n                        fullName: fullName\n                    }\n                };\n            }));\n        }\n\n        function getMyRequests() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const currentUserId = currentAccount().id;\n            const myRequests = requests.filter(x => x.employeeId === currentUserId);\n\n            return ok(myRequests.map(request => {\n                const items = requestItems.filter(item => item.requestId === request.id);\n                const employee = employees.find(e => e.id === request.employeeId);\n                const account = accounts.find(a => a.id === employee?.accountId);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                return {\n                    ...request,\n                    items,\n                    employee: employee ? {\n                        ...employee,\n                        fullName: `${account?.firstName || ''} ${account?.lastName || ''}`.trim(),\n                        employeeId: employee.employeeId\n                    } : null,\n                    type: requestType ? requestType.name : request.type\n                };\n            }));\n        }\n\n        function createRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            console.log('Received request data:', body);\n\n            // Find employee by employeeId\n            let targetEmployee;\n            if (body.employeeId) {\n                // Try to find by internal ID first\n                const employeeIdNum = Number(body.employeeId);\n                targetEmployee = employees.find(e => e.id === employeeIdNum);\n                \n                if (!targetEmployee) {\n                    // If not found by internal ID, try to find by employee ID string\n                    targetEmployee = employees.find(e => e.employeeId === body.employeeId);\n                }\n                \n                if (!targetEmployee) {\n                    console.error('Employee not found for ID:', body.employeeId);\n                    return error('Employee not found');\n                }\n            } else {\n                // If no employeeId provided, use current user\n                const currentUser = currentAccount();\n                targetEmployee = employees.find(e => e.accountId === currentUser.id);\n                if (!targetEmployee) {\n                    console.error('No employee found for current user');\n                    return error('Current user is not an employee');\n                }\n            }\n\n            console.log('Target employee found:', targetEmployee);\n\n            const request = {\n                id: newRequestId(),\n                employeeId: targetEmployee.id,\n                typeId: body.typeId ? Number(body.typeId) : null,\n                type: body.type,\n                description: body.description || '',\n                status: 'Pending',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n\n            console.log('Creating request:', request);\n\n            // Validate required fields\n            if (!request.type && !request.typeId) {\n                return error('Request type is required');\n            }\n\n            // Validate and process items if present\n            let requestItemsList = [];\n            if (body.items && Array.isArray(body.items)) {\n                try {\n                    requestItemsList = body.items.map(item => {\n                        if (!item.name || !item.quantity) {\n                            throw new Error('Invalid item data');\n                        }\n                        return {\n                    id: newRequestItemId(),\n                    requestId: request.id,\n                    name: item.name,\n                            quantity: Number(item.quantity)\n                        };\n                    });\n                } catch (error) {\n                    return error('Invalid item data provided');\n                }\n            }\n\n            // Save request and items\n            requests.push(request);\n            if (requestItemsList.length > 0) {\n                requestItems.push(...requestItemsList);\n                localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n            }\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n            const account = accounts.find(a => a.id === targetEmployee.accountId);\n            const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            const fullName = `${firstName} ${lastName}`.trim();\n\n            const response = {\n                ...request,\n                items: requestItemsList,\n                employee: {\n                    id: targetEmployee.id,\n                    employeeId: targetEmployee.employeeId,\n                    fullName: fullName\n                }\n            };\n\n            console.log('Created request:', response);\n            return ok(response);\n        }\n\n        function updateRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            console.log('Received update data:', body);\n\n            const requestId = idFromUrl();\n            const request = requests.find(x => x.id === requestId);\n\n            if (!request) return notFound();\n            if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n\n            // Update basic request fields\n            Object.assign(request, {\n                type: body.type,\n                description: body.description || request.description,\n                lastModifiedDate: new Date().toISOString()\n            });\n\n            // Handle item changes\n            if (body.items) {\n                // Remove all existing items for this request\n                requestItems = requestItems.filter(item => item.requestId !== requestId);\n\n                // Add new/updated items\n                const newItems = body.items.map(item => ({\n                    id: item.id || newRequestItemId(),\n                        requestId: requestId,\n                        name: item.name,\n                    quantity: Number(item.quantity)\n                    }));\n\n                requestItems.push(...newItems);\n                localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n            }\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n            // Get related data for response\n            const employee = employees.find(e => e.id === request.employeeId);\n            const account = accounts.find(a => a.id === employee?.accountId);\n            const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            const fullName = `${firstName} ${lastName}`.trim();\n\n            return ok({\n                ...request,\n                items: requestItems.filter(item => item.requestId === requestId),\n                employee: employee ? {\n                    ...employee,\n                    fullName: fullName,\n                    employeeId: employee.employeeId\n                } : null\n            });\n        }\n\n        function changeRequestStatus() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const requestId = idFromUrl();\n            const request = requests.find(x => x.id === requestId);\n            \n            if (!request) {\n                console.error('Request not found with ID:', requestId);\n                return notFound();\n            }\n\n            const newStatus = body.status;\n            if (!newStatus) {\n                console.error('No status provided in request body');\n                return error('Status is required');\n            }\n\n            // Validate status value\n            const validStatuses = ['Pending', 'Approved', 'Rejected', 'Cancelled'];\n            if (!validStatuses.includes(newStatus)) {\n                console.error('Invalid status value:', newStatus);\n                return error('Invalid status value');\n            }\n\n            try {\n                // Update request\n                request.status = newStatus;\n                request.lastModifiedDate = new Date().toISOString();\n\n                // Update requests array\n                const requestIndex = requests.findIndex(x => x.id === requestId);\n                if (requestIndex === -1) {\n                    console.error('Request not found in array');\n                    return error('Request not found');\n                }\n                requests[requestIndex] = request;\n                localStorage.setItem(requestsKey, JSON.stringify(requests));\n\n                // Get related data for response\n                const employee = employees.find(e => e.id === request.employeeId);\n                const account = accounts.find(a => a.id === employee?.accountId);\n                const requestType = requestTypes.find(t => t.id === request.typeId);\n                const items = requestItems.filter(item => item.requestId === request.id);\n\n                // Format employee name\n                const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n                const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n                const fullName = `${firstName} ${lastName}`.trim();\n\n                const response = {\n                    ...request,\n                    type: requestType?.name || request.type,\n                    items: items,\n                    employee: employee ? {\n                        id: employee.id,\n                        employeeId: employee.employeeId,\n                        fullName: fullName\n                    } : null\n                };\n\n                console.log('Request status updated successfully:', response);\n                return ok(response);\n            } catch (error) {\n                console.error('Error updating request status:', error);\n                return error('Failed to update request status');\n            }\n        }\n\n        function deleteRequest() {\n            if (!isAuthenticated()) return unauthorized();\n\n            const requestId = idFromUrl();\n            const request = requests.find(x => x.id === requestId);\n\n            if (!request) return notFound();\n            if (request.employeeId !== currentAccount().id && !isAdmin()) return unauthorized();\n\n            // Delete request and its items\n            requests = requests.filter(x => x.id !== requestId);\n            requestItems = requestItems.filter(x => x.requestId !== requestId);\n\n            localStorage.setItem(requestsKey, JSON.stringify(requests));\n            localStorage.setItem(requestItemsKey, JSON.stringify(requestItems));\n\n            return ok();\n        }\n\n        // Employee functions\n        function getEmployees() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(employees.map(employee => {\n                const department = departments.find(d => d.id === employee.departmentId);\n                const account = accounts.find(a => a.id === employee.accountId);\n                \n                // Format names with proper capitalization\n                const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n                const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n                \n                return {\n                    ...employee,\n                    employeeId: employee.employeeId,\n                    fullName: `${firstName} ${lastName}`.trim(),\n                    departmentName: department?.name || '',\n                    department: department ? {\n                        id: department.id,\n                        name: department.name,\n                        description: department.description\n                    } : null,\n                    account: account ? basicDetails(account) : null\n                };\n            }));\n        }\n\n        function getEmployeeById() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employee = employees.find(x => x.id === employeeId);\n            \n            if (!employee) return notFound();\n            \n            // Get fresh department data\n            const department = departments.find(d => d.id === employee.departmentId);\n            if (!department) return error('Department not found');\n            \n            const account = accounts.find(a => a.id === employee.accountId);\n            const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            \n            // Return complete employee data with fresh relations\n            return ok({\n                ...employee,\n                employeeId: employee.employeeId,\n                fullName: `${firstName} ${lastName}`.trim(),\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        function createEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            // Log the received data for debugging\n            console.log('Received employee data:', body);\n\n            // Check if employee ID already exists\n            if (employees.find(x => x.employeeId === body.employeeId)) {\n                return error('Employee ID already exists');\n            }\n\n            // Validate department exists\n            const department = departments.find(d => d.id === Number(body.departmentId));\n            if (!department) return error('Department not found');\n\n            // Validate account exists and isn't already assigned to an employee\n            const account = accounts.find(a => a.id === Number(body.accountId));\n            if (!account) return error('Account not found');\n            if (employees.find(e => e.accountId === Number(body.accountId))) {\n                return error('Account is already assigned to another employee');\n            }\n\n            const employee = {\n                id: newEmployeeId(),\n                accountId: Number(body.accountId),\n                employeeId: body.employeeId,\n                departmentId: Number(body.departmentId),\n                position: body.position,\n                hireDate: body.hireDate,\n                salary: Number(body.salary),\n                status: body.status || 'Active',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Check each required field individually and log the result\n            const requiredFields = {\n                accountId: !!employee.accountId,\n                employeeId: !!employee.employeeId,\n                departmentId: !!employee.departmentId,\n                position: !!employee.position,\n                hireDate: !!employee.hireDate,\n                salary: !!employee.salary\n            };\n            \n            console.log('Field validation results:', requiredFields);\n            \n            // Check if any required field is missing\n            const missingFields = Object.entries(requiredFields)\n                .filter(([_, isValid]) => !isValid)\n                .map(([fieldName]) => fieldName);\n            \n            if (missingFields.length > 0) {\n                return error(`Required fields are missing: ${missingFields.join(', ')}`);\n            }\n\n            // Format names\n            const firstName = account.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            \n            // Create workflow entry for new employee\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employee.id,\n                type: 'Added',\n                details: {\n                    task: `New employee ${employee.employeeId} was added`,\n                    additionalInfo: `Added to ${department.name} department as ${employee.position}`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            employees.push(employee);\n            workflows.push(workflow);\n            \n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...employee,\n                fullName: `${firstName} ${lastName}`.trim(),\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                }\n            });\n        }\n\n        function updateEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const employeeId = idFromUrl();\n            const employeeIndex = employees.findIndex(x => x.id === employeeId);\n            \n            if (employeeIndex === -1) return notFound();\n            \n            const oldEmployee = employees[employeeIndex];\n            const updatedEmployee = {\n                ...oldEmployee,\n                ...body,\n                id: employeeId,\n                accountId: body.accountId ? Number(body.accountId) : oldEmployee.accountId,\n                departmentId: body.departmentId ? Number(body.departmentId) : oldEmployee.departmentId,\n                position: body.position || oldEmployee.position,\n                salary: body.salary ? Number(body.salary) : oldEmployee.salary,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate department exists if changed\n            if (body.departmentId) {\n                const department = departments.find(d => d.id === updatedEmployee.departmentId);\n                if (!department) return error('Department not found');\n            }\n\n            // Validate account exists if changed\n            if (body.accountId) {\n                const account = accounts.find(a => a.id === updatedEmployee.accountId);\n                if (!account) return error('Account not found');\n            }\n            \n            const department = departments.find(d => d.id === updatedEmployee.departmentId);\n            const account = accounts.find(a => a.id === updatedEmployee.accountId);\n            \n            // Create workflow entry for updated employee\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employeeId,\n                type: 'Updated',\n                details: {\n                    task: `Employee ${employeeId} was updated`,\n                    additionalInfo: `Updated in ${department.name} department`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            employees.push(updatedEmployee);\n            workflows.push(workflow);\n            \n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...updatedEmployee,\n                departmentName: department.name,\n                department: {\n                    id: department.id,\n                    name: department.name,\n                    description: department.description\n                },\n                account: basicDetails(account)\n            });\n        }\n\n        function deleteEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const employeeId = idFromUrl();\n            const employeeIndex = employees.findIndex(x => x.id === employeeId);\n            \n            if (employeeIndex === -1) return notFound();\n            \n            const employee = employees[employeeIndex];\n            \n            // Delete employee\n            employees = employees.filter(x => x.id !== employeeId);\n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            \n            return ok({\n                ...employee,\n                status: 'Deleted'\n            });\n        }\n\n        function transferEmployee() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const employeeId = idFromUrl();\n            \n            // Find the employee index\n            const employeeIndex = employees.findIndex(x => x.id === employeeId);\n            if (employeeIndex === -1) {\n                console.error('Employee not found:', employeeId);\n                return notFound();\n            }\n            \n            // Get the current employee\n            const employee = employees[employeeIndex];\n            const oldDepartmentId = employee.departmentId;\n            const newDepartmentId = Number(body.departmentId);\n            \n            // Validate departments exist\n            const oldDepartment = departments.find(d => d.id === oldDepartmentId);\n            const newDepartment = departments.find(d => d.id === newDepartmentId);\n            if (!oldDepartment || !newDepartment) {\n                console.error('Department not found. Old:', oldDepartmentId, 'New:', newDepartmentId);\n                return error('Department not found');\n            }\n\n            // Don't do anything if the department hasn't changed\n            if (oldDepartmentId === newDepartmentId) {\n                console.log('Employee already in department:', newDepartmentId);\n                return error('Employee is already in this department');\n            }\n\n            console.log('Transferring employee', employee.employeeId, 'from', oldDepartment.name, 'to', newDepartment.name);\n\n            // Update the employee's department\n            employees[employeeIndex] = {\n                ...employee,\n                departmentId: newDepartmentId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Get employee account for name\n            const account = accounts.find(a => a.id === employee.accountId);\n            const firstName = account?.firstName ? account.firstName.charAt(0).toUpperCase() + account.firstName.slice(1).toLowerCase() : '';\n            const lastName = account?.lastName ? account.lastName.charAt(0).toUpperCase() + account.lastName.slice(1).toLowerCase() : '';\n            \n            // Create workflow entry for transfer\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: employeeId,\n                type: 'Transferred',\n                details: {\n                    task: `Employee ${employee.employeeId} was transferred`,\n                    additionalInfo: `From ${oldDepartment.name} to ${newDepartment.name} department`\n                },\n                status: 'Completed',\n                createdDate: new Date().toISOString(),\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            workflows.push(workflow);\n            \n            // Save changes\n            localStorage.setItem(employeesKey, JSON.stringify(employees));\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n\n            console.log('Transfer completed successfully');\n            \n            return ok({\n                ...employees[employeeIndex],\n                fullName: `${firstName} ${lastName}`.trim(),\n                departmentName: newDepartment.name,\n                department: {\n                    id: newDepartment.id,\n                    name: newDepartment.name,\n                    description: newDepartment.description\n                }\n            });\n        }\n\n        // Department functions\n        function getDepartments() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(departments.map(department => {\n                return {\n                    ...department,\n                    id: department.id.toString(),\n                    name: department.name,\n                    description: department.description\n                };\n            }));\n        }\n\n        function getDepartmentById() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const departmentId = idFromUrl();\n            const department = departments.find(x => x.id === departmentId);\n            \n            if (!department) return notFound();\n            \n            return ok({\n                ...department,\n                id: department.id.toString(),\n                name: department.name,\n                description: department.description\n            });\n        }\n\n        function createDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const department = body;\n            \n            // Validate department name is unique\n            if (departments.find(x => x.name === department.name)) {\n                return error('Department name already exists');\n            }\n            \n            // Assign department id and save\n            department.id = newDepartmentId();\n            departments.push(department);\n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok({\n                ...department,\n                id: department.id.toString()\n            });\n        }\n\n        function updateDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const departmentId = idFromUrl();\n            const departmentIndex = departments.findIndex(x => x.id === departmentId);\n            \n            if (departmentIndex === -1) return notFound();\n            \n            const oldDepartment = departments[departmentIndex];\n            const updatedDepartment = {\n                ...oldDepartment,\n                ...body,\n                id: departmentId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate department name is unique\n            if (departments.find(x => x.name === updatedDepartment.name && x.id !== updatedDepartment.id)) {\n                return error('Department name already exists');\n            }\n\n            departments.push(updatedDepartment);\n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok({\n                ...updatedDepartment,\n                id: updatedDepartment.id.toString()\n            });\n        }\n\n        function deleteDepartment() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const departmentId = idFromUrl();\n            const departmentIndex = departments.findIndex(x => x.id === departmentId);\n            \n            if (departmentIndex === -1) return notFound();\n            \n            const department = departments[departmentIndex];\n            \n            // Delete department\n            departments = departments.filter(x => x.id !== departmentId);\n            localStorage.setItem(departmentsKey, JSON.stringify(departments));\n            \n            return ok({\n                ...department,\n                status: 'Deleted'\n            });\n        }\n\n        // Position functions\n        function getPositions() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(positions.map(position => {\n                return {\n                    ...position,\n                    id: position.id.toString(),\n                    name: position.name,\n                    description: position.description\n                };\n            }));\n        }\n\n        function getPositionById() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const positionId = idFromUrl();\n            const position = positions.find(x => x.id === positionId);\n            \n            if (!position) return notFound();\n            \n            return ok({\n                ...position,\n                id: position.id.toString(),\n                name: position.name,\n                description: position.description\n            });\n        }\n\n        function createPosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const position = body;\n            \n            // Validate position name is unique\n            if (positions.find(x => x.name === position.name)) {\n                return error('Position name already exists');\n            }\n            \n            // Assign position id and save\n            position.id = newPositionId();\n            positions.push(position);\n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok({\n                ...position,\n                id: position.id.toString()\n            });\n        }\n\n        function updatePosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const positionId = idFromUrl();\n            const positionIndex = positions.findIndex(x => x.id === positionId);\n            \n            if (positionIndex === -1) return notFound();\n            \n            const oldPosition = positions[positionIndex];\n            const updatedPosition = {\n                ...oldPosition,\n                ...body,\n                id: positionId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate position name is unique\n            if (positions.find(x => x.name === updatedPosition.name && x.id !== updatedPosition.id)) {\n                return error('Position name already exists');\n            }\n\n            positions.push(updatedPosition);\n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok({\n                ...updatedPosition,\n                id: updatedPosition.id.toString()\n            });\n        }\n\n        function deletePosition() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const positionId = idFromUrl();\n            const positionIndex = positions.findIndex(x => x.id === positionId);\n            \n            if (positionIndex === -1) return notFound();\n            \n            const position = positions[positionIndex];\n            \n            // Delete position\n            positions = positions.filter(x => x.id !== positionId);\n            localStorage.setItem(positionsKey, JSON.stringify(positions));\n            \n            return ok({\n                ...position,\n                status: 'Deleted'\n            });\n        }\n\n        // Request type functions\n        function getRequestTypes() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            return ok(requestTypes.map(type => {\n                return {\n                    ...type,\n                    id: type.id.toString(),\n                    name: type.name,\n                    description: type.description\n                };\n            }));\n        }\n\n        function getRequestTypeById() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const typeId = idFromUrl();\n            const type = requestTypes.find(x => x.id === typeId);\n            \n            if (!type) return notFound();\n            \n            return ok({\n                ...type,\n                id: type.id.toString(),\n                name: type.name,\n                description: type.description\n            });\n        }\n\n        function createRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const type = body;\n            \n            // Validate request type name is unique\n            if (requestTypes.find(x => x.name === type.name)) {\n                return error('Request type name already exists');\n            }\n            \n            // Assign request type id and save\n            type.id = newRequestTypeId();\n            requestTypes.push(type);\n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok({\n                ...type,\n                id: type.id.toString()\n            });\n        }\n\n        function updateRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const typeId = idFromUrl();\n            const typeIndex = requestTypes.findIndex(x => x.id === typeId);\n            \n            if (typeIndex === -1) return notFound();\n            \n            const oldType = requestTypes[typeIndex];\n            const updatedType = {\n                ...oldType,\n                ...body,\n                id: typeId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate request type name is unique\n            if (requestTypes.find(x => x.name === updatedType.name && x.id !== updatedType.id)) {\n                return error('Request type name already exists');\n            }\n\n            requestTypes.push(updatedType);\n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok({\n                ...updatedType,\n                id: updatedType.id.toString()\n            });\n        }\n\n        function deleteRequestType() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const typeId = idFromUrl();\n            const typeIndex = requestTypes.findIndex(x => x.id === typeId);\n            \n            if (typeIndex === -1) return notFound();\n            \n            const type = requestTypes[typeIndex];\n            \n            // Delete request type\n            requestTypes = requestTypes.filter(x => x.id !== typeId);\n            localStorage.setItem(requestTypesKey, JSON.stringify(requestTypes));\n            \n            return ok({\n                ...type,\n                status: 'Deleted'\n            });\n        }\n\n        // Workflow functions\n        function getWorkflows() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            // Only include objects that are true workflows (type is 'Added', 'Updated', or 'Transferred' and do NOT have request-like properties)\n            const workflowTypes = ['Added', 'Updated', 'Transferred'];\n            const sortedWorkflows = [...workflows]\n                .filter(wf => {\n                    return (\n                        typeof wf.type === 'string' &&\n                        workflowTypes.includes(wf.type) &&\n                        !('items' in wf) &&\n                        !('typeId' in wf) &&\n                        !('description' in wf)\n                    );\n                })\n                .sort((a, b) => {\n                    const dateA = new Date(a.datetimecreated || a.createdDate);\n                    const dateB = new Date(b.datetimecreated || b.createdDate);\n                    return dateB.getTime() - dateA.getTime();\n                });\n\n            const result = sortedWorkflows.map(workflow => {\n                // Ensure details is a string\n                let details = '';\n                if (typeof workflow.details === 'object') {\n                    details = workflow.details.task || '';\n                    if (workflow.details.additionalInfo) {\n                        details += ` - ${workflow.details.additionalInfo}`;\n                    }\n                } else {\n                    details = workflow.details || '';\n                }\n                // Always provide datetimecreated\n                const datetimecreated = workflow.datetimecreated || workflow.createdDate;\n                return {\n                    id: workflow.id.toString(),\n                    type: workflow.type,\n                    details: details,\n                    status: workflow.status,\n                    datetimecreated: datetimecreated,\n                    employeeId: workflow.employeeId\n                };\n            });\n            console.log('Workflows sent to frontend:', result);\n            return ok(result);\n        }\n\n        function getWorkflowById() {\n            if (!isAuthenticated()) return unauthorized();\n            const workflow = workflows.find(x => x.id === idFromUrl());\n            if (!workflow) return notFound();\n            \n            const details = typeof workflow.details === 'object' ? \n                `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` :\n                workflow.details || '';\n\n            return ok({\n                id: workflow.id.toString(),\n                type: workflow.type,\n                details: details,\n                status: workflow.status,\n                datetimecreated: workflow.datetimecreated || workflow.createdDate\n            });\n        }\n\n        function getWorkflowsByRequestId() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const requestId = idFromUrl();\n            console.log('Looking for workflows with requestId:', requestId);\n\n            const request = requests.find(x => x.id === requestId);\n            if (!request) {\n                console.log('Request not found with id:', requestId);\n                return notFound();\n            }\n            \n            const requestWorkflows = workflows.filter(x => x.requestId === requestId);\n            console.log('Found workflows:', requestWorkflows.length);\n\n            // Sort workflows in descending order\n            const sortedWorkflows = [...requestWorkflows].sort((a, b) => {\n                const dateA = new Date(a.datetimecreated || a.createdDate);\n                const dateB = new Date(b.datetimecreated || b.createdDate);\n                return dateB.getTime() - dateA.getTime();\n            });\n\n            return ok(sortedWorkflows.map(workflow => {\n                const details = typeof workflow.details === 'object' ? \n                    `${workflow.details.task}${workflow.details.additionalInfo ? ` - ${workflow.details.additionalInfo}` : ''}` :\n                    workflow.details || '';\n\n                return {\n                    id: workflow.id.toString(),\n                    type: workflow.type,\n                    details: details,\n                    status: workflow.status,\n                    datetimecreated: workflow.datetimecreated || workflow.createdDate\n                };\n            }));\n        }\n\n        function createWorkflow() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            console.log('Received workflow data:', body);\n\n            // Format details as a string\n            let details = '';\n            if (typeof body.details === 'object') {\n                details = body.details.task || '';\n                if (body.details.additionalInfo) {\n                    details += ` - ${body.details.additionalInfo}`;\n                }\n            } else {\n                details = body.details || '';\n            }\n\n            const now = new Date().toISOString();\n            const workflow = {\n                id: newWorkflowId(),\n                employeeId: body.employeeId,\n                type: body.type,\n                details: details,\n                status: 'ForReviewing', // Default status\n                createdDate: now,\n                datetimecreated: now,\n                lastModifiedDate: now\n            };\n            \n            // Validate required fields\n            const requiredFields = {\n                employeeId: !!workflow.employeeId,\n                type: !!workflow.type,\n                details: !!workflow.details,\n                status: !!workflow.status\n            };\n            \n            console.log('Field validation results:', requiredFields);\n            \n            // Check if any required field is missing\n            const missingFields = Object.entries(requiredFields)\n                .filter(([_, isValid]) => !isValid)\n                .map(([fieldName]) => fieldName);\n            \n            if (missingFields.length > 0) {\n                return error(`Required fields are missing: ${missingFields.join(', ')}`);\n            }\n\n            // Validate employee exists\n            const employee = employees.find(e => e.id === workflow.employeeId);\n            if (!employee) return error('Employee not found');\n            \n            workflows.push(workflow);\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...workflow,\n                employee: employee ? {\n                    ...employee,\n                    employeeId: employee.employeeId\n                } : null\n            });\n        }\n\n        function updateWorkflow() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const workflowId = idFromUrl();\n            const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n            \n            if (workflowIndex === -1) return notFound();\n            \n            const oldWorkflow = workflows[workflowIndex];\n            const updatedWorkflow = {\n                ...oldWorkflow,\n                ...body,\n                id: workflowId,\n                lastModifiedDate: new Date().toISOString()\n            };\n            \n            // Validate employee exists\n            const employee = employees.find(e => e.id === updatedWorkflow.employeeId);\n            if (!employee) return error('Employee not found');\n            \n            workflows[workflowIndex] = updatedWorkflow;\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...updatedWorkflow,\n                employee: employee ? {\n                    ...employee,\n                    employeeId: employee.employeeId\n                } : null\n            });\n        }\n\n        function updateWorkflowStatus() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const workflowId = idFromUrl();\n            const workflow = workflows.find(x => x.id === workflowId);\n            \n            if (!workflow) return notFound();\n            \n            const newStatus = body.status;\n\n            Object.assign(workflow, {\n                status: newStatus,\n                lastModifiedDate: new Date().toISOString()\n            });\n\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n\n            return ok({\n                ...workflow,\n                status: newStatus\n            });\n        }\n\n        function deleteWorkflow() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const workflowId = idFromUrl();\n            const workflowIndex = workflows.findIndex(x => x.id === workflowId);\n            \n            if (workflowIndex === -1) return notFound();\n            \n            const workflow = workflows[workflowIndex];\n            const employee = employees.find(e => e.id === workflow.employeeId);\n            \n            // Delete workflow\n            workflows = workflows.filter(x => x.id !== workflowId);\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...workflow,\n                employee: employee ? {\n                    ...employee,\n                    employeeId: employee.employeeId\n                } : null\n            });\n        }\n\n        function deleteWorkflowItem() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n\n            const workflowId = idFromUrl();\n            const workflow = workflows.find(x => x.id === workflowId);\n            \n            if (!workflow) return notFound();\n            \n            // Delete workflow item\n            workflows = workflows.filter(x => x.id !== workflowId);\n            localStorage.setItem(workflowsKey, JSON.stringify(workflows));\n            \n            return ok({\n                ...workflow,\n                status: 'Deleted'\n            });\n        }\n\n        function createAccount() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const account = body;\n            \n            if (accounts.find(x => x.email === account.email)) {\n                return error('Email already exists');\n            }\n            \n            account.id = newAccountId();\n            account.dateCreated = new Date().toISOString();\n            account.isVerified = true;\n            account.refreshTokens = [];\n            \n            accounts.push(account);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n            \n            return ok(basicDetails(account));\n        }\n\n        function updateAccount() {\n            if (!isAuthenticated()) return unauthorized();\n            \n            const accountId = idFromUrl();\n            const account = accounts.find(x => x.id === accountId);\n            \n            if (!account) return notFound();\n            if (account.id !== currentAccount().id && !isAdmin()) return unauthorized();\n            \n            // Only allow admins to update role\n            if (!isAdmin()) {\n                delete body.role;\n            }\n            \n            // If email is being changed, make sure it's not already taken\n            if (body.email && body.email !== account.email && accounts.find(x => x.email === body.email)) {\n                return error('Email already exists');\n            }\n            \n            Object.assign(account, body);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n            \n            return ok(basicDetails(account));\n        }\n\n        function deleteAccount() {\n            if (!isAuthenticated() || !isAdmin()) return unauthorized();\n            \n            const accountId = idFromUrl();\n            const account = accounts.find(x => x.id === accountId);\n            \n            if (!account) return notFound();\n            if (account.id === currentAccount().id) return error('You cannot delete your own account');\n            \n            accounts = accounts.filter(x => x.id !== accountId);\n            localStorage.setItem(accountsKey, JSON.stringify(accounts));\n            \n            return ok();\n        }\n    }\n}\n\nexport const fakeBackendProvider = {\n    // use fake backend in place of Http service for backend-less development\n    provide: HTTP_INTERCEPTORS,\n    useClass: FakeBackendInterceptor,\n    multi: true\n};"]},"metadata":{},"sourceType":"module","externalDependencies":[]}